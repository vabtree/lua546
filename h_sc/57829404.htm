<html>
<head>
<!-- This html document was created by Imagix 4D -->
<link href="../htm/symbol.css" rel="stylesheet" type="text/css">
<link href="../htm/symcolors.css" rel="stylesheet" type="text/css">
<link href="../htm/notebook.css" rel="stylesheet" type="text/css">
<base target="symbol">
</head>
<body>

<h2>lgc.c</h2>

<div class="notebook">
<ul>
<li><a href="../h_aa/57829404.htm" class="file" target="_self">Info</a></li>
<li><a href="../h_im/57829404.htm" class="file" target="_self">Global Interface</a></li>
<li><a href="../h_rx/57829404.htm" class="file" target="_self">File Inclusion</a></li>
<li><a href="../h_nm/57829404.htm" class="file" target="_self">Internals</a></li>
<li><a href="../h_uf/57829404.htm" class="file" target="_self">Use of Elements</a></li>
<li><a href="../h_df/57829404.htm" class="file" target="_self">Dependencies</a></li>
<li id="current"><a href="../h_src/57829404.htm" class="file" target="_self">Source Code</a></li>
</ul>
</div>
<div class="notebook">
<ul>
<li><a href="../h_src/57829404.htm" class="file" target="_self">Source Code</a></li>
<li id="current"><a href="../h_sc/57829404.htm" class="file" target="_self">Source Checks</a></li>
</ul>
</div>
<div class="nb_clear">
</div>
<h4>Source Checks  <a class="legend">(see key)</a></h4>
<table cellpadding=0 cellspacing=0 border=0>
<tr><td>total instances:</td><td class=mtrc>334</td></tr>
<tr><td>total checks involved:</td><td class=mtrc>8</td></tr>
<tr><td>total lines  involved:</td><td class=mtrc>287</td></tr>
<tr><th></th></tr>
</table>
<pre>
</pre>
<h5>Number of Built-In Operators</h5>
<pre>
   221 :    <a href="../h_src/57828112.htm" class="macro">makewhite</a>(<a href="../h_src/57823896.htm" class="localvar">g</a>, <a href="../h_src/57824168.htm" class="localvar">o</a>);  <a  class="comments">/* mark 'o' as white to avoid other barriers */</a>
   310 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57821584.htm" class="localvar">g</a>, <a href="../h_src/57821312.htm" class="localvar">uv</a>-&gt;<a href="../h_src/57510564.htm" class="variable">v</a>.<a href="../h_src/57510768.htm" class="variable">p</a>);  <a  class="comments">/* mark its content */</a>
   385 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57819952.htm" class="localvar">g</a>, <a href="../h_src/57819340.htm" class="localvar">uv</a>-&gt;<a href="../h_src/57510564.htm" class="variable">v</a>.<a href="../h_src/57510768.htm" class="variable">p</a>);  <a  class="comments">/* mark its value */</a>
   406 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57818796.htm" class="localvar">g</a>, &amp;<a href="../h_src/57818796.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646296.htm" class="variable">l_registry</a>);
   489 :    if (<a href="../h_src/57827704.htm" class="macro">valiswhite</a>(&amp;<a href="../h_src/57977140.htm" class="localvar">h</a>-&gt;<a href="../h_src/57504716.htm" class="variable">array</a>[<a href="../h_src/57976460.htm" class="localvar">i</a>])) {
   502 :    if (<a href="../h_src/57827704.htm" class="macro">valiswhite</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57976052.htm" class="localvar">n</a>)))  <a  class="comments">/* value not marked yet? */</a><a href="../h_src/57528040.htm" class="variable">marked</a> yet? */
   505 :    else if (<a href="../h_src/57827704.htm" class="macro">valiswhite</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57976052.htm" class="localvar">n</a>))) {  <a  class="comments">/* value not marked yet? */</a><a href="../h_src/57528040.htm" class="variable">marked</a> yet? */
   528 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57975780.htm" class="localvar">g</a>, &amp;<a href="../h_src/57975644.htm" class="localvar">h</a>-&gt;<a href="../h_src/57504716.htm" class="variable">array</a>[<a href="../h_src/57975236.htm" class="localvar">i</a>]);
   535 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57975780.htm" class="localvar">g</a>, <a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57975508.htm" class="localvar">n</a>));
   546 :    if (<a href="../h_src/57974284.htm" class="localvar">mode</a> &amp;&amp; <a href="../h_src/57524912.htm" class="macro">ttisstring</a>(<a href="../h_src/57974284.htm" class="localvar">mode</a>) &amp;&amp;  <a  class="comments">/* is there a weak mode? */</a>
   547 :    (<a href="../h_src/57547624.htm" class="macro">cast_void</a>(<a href="../h_src/57974556.htm" class="localvar">weakkey</a> = <a href="../h_aa/57565916.htm" class="libfunc">strchr</a>(<a href="../h_src/57522532.htm" class="macro">svalue</a>(<a href="../h_src/57974284.htm" class="localvar">mode</a>), 'k')),
   548 :    <a href="../h_src/57547624.htm" class="macro">cast_void</a>(<a href="../h_src/57974420.htm" class="localvar">weakvalue</a> = <a href="../h_aa/57565916.htm" class="libfunc">strchr</a>(<a href="../h_src/57522532.htm" class="macro">svalue</a>(<a href="../h_src/57974284.htm" class="localvar">mode</a>), 'v')),
   549 :    (<a href="../h_src/57974556.htm" class="localvar">weakkey</a> || <a href="../h_src/57974420.htm" class="localvar">weakvalue</a>))) {  <a  class="comments">/* is really weak? */</a>
   567 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57974012.htm" class="localvar">g</a>, &amp;<a href="../h_src/57973876.htm" class="localvar">u</a>-&gt;<a href="../h_src/57519336.htm" class="variable">uv</a>[<a href="../h_src/57973740.htm" class="localvar">i</a>].<a href="../h_src/57520764.htm" class="variable">uv</a>);
   582 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57973468.htm" class="localvar">g</a>, &amp;<a href="../h_src/57973332.htm" class="localvar">f</a>-&gt;<a href="../h_src/57515052.htm" class="variable">k</a>[<a href="../h_src/57973196.htm" class="localvar">i</a>]);
   596 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57972924.htm" class="localvar">g</a>, &amp;<a href="../h_src/57972788.htm" class="localvar">cl</a>-&gt;<a href="../h_src/57508796.htm" class="variable">upvalue</a>[<a href="../h_src/57972652.htm" class="localvar">i</a>]);
   637 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57971700.htm" class="localvar">g</a>, <a href="../h_src/57531712.htm" class="macro">s2v</a>(<a href="../h_src/57971292.htm" class="localvar">o</a>));
   892 :    <a href="../h_src/57828112.htm" class="macro">makewhite</a>(<a href="../h_src/57962996.htm" class="localvar">g</a>, <a href="../h_src/57962860.htm" class="localvar">o</a>);  <a  class="comments">/* &quot;sweep&quot; object */</a>
  1019 :    if (<a href="../h_src/57625964.htm" class="macro">tofinalize</a>(<a href="../h_src/57957284.htm" class="localvar">o</a>) ||                 <a  class="comments">/* obj. is already marked... */</a><a href="../h_src/57528040.htm" class="variable">marked</a>... */
  1020 :    <a href="../h_src/57498664.htm" class="macro">gfasttm</a>(<a href="../h_src/57957012.htm" class="localvar">g</a>, <a href="../h_src/57957148.htm" class="localvar">mt</a>, <a href="../h_src/57500772.htm" class="variable">TM_GC</a>) == NULL ||    <a  class="comments">/* or has no finalizer... */</a>
  1021 :    (<a href="../h_src/57957012.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645684.htm" class="variable">gcstp</a> &amp; <a href="../h_src/57622020.htm" class="macro">GCSTPCLS</a>))                   <a  class="comments">/* or closing state? */</a>
  1026 :    <a href="../h_src/57828112.htm" class="macro">makewhite</a>(<a href="../h_src/57957012.htm" class="localvar">g</a>, <a href="../h_src/57957284.htm" class="localvar">o</a>);  <a  class="comments">/* &quot;sweep&quot; object 'o' */</a>
  1092 :    else if (<a href="../h_src/57955516.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528108.htm" class="variable">tt</a> == <a href="../h_src/57513760.htm" class="macro">LUA_VUPVAL</a> &amp;&amp; <a href="../h_src/57631540.htm" class="macro">upisopen</a>(<a href="../h_src/57639020.htm" class="macro">gco2upv</a>(<a href="../h_src/57955516.htm" class="localvar">curr</a>)))
  1157 :    <a href="../h_src/57953476.htm" class="localvar">p</a>-&gt;<a href="../h_src/57528040.htm" class="variable">marked</a> = <a href="../h_src/57546944.htm" class="macro">cast_byte</a>((<a href="../h_src/57953476.htm" class="localvar">p</a>-&gt;<a href="../h_src/57528040.htm" class="variable">marked</a> &amp; ~<a href="../h_src/57828248.htm" class="macro">maskgcbits</a>) | <a href="../h_src/57953340.htm" class="localvar">white</a>);
  1534 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57945316.htm" class="localvar">g</a>, &amp;<a href="../h_src/57945316.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646296.htm" class="variable">l_registry</a>);
</pre>
<pre>
</pre>
<h5>Unclear Subexpression</h5>
<pre>
   127 :    case <a href="../h_src/57507436.htm" class="macro">LUA_VTABLE</a>: return &amp;<a href="../h_src/57639428.htm" class="macro">gco2t</a>(<a href="../h_src/57826072.htm" class="localvar">o</a>)-&gt;<a href="../h_src/57504376.htm" class="variable">gclist</a>;
   128 :    case <a href="../h_src/57513624.htm" class="macro">LUA_VLCL</a>: return &amp;<a href="../h_src/57639836.htm" class="macro">gco2lcl</a>(<a href="../h_src/57826072.htm" class="localvar">o</a>)-&gt;<a href="../h_src/57508252.htm" class="variable">gclist</a>;
   129 :    case <a href="../h_src/57513352.htm" class="macro">LUA_VCCL</a>: return &amp;<a href="../h_src/57639700.htm" class="macro">gco2ccl</a>(<a href="../h_src/57826072.htm" class="localvar">o</a>)-&gt;<a href="../h_src/57509000.htm" class="variable">gclist</a>;
   130 :    case <a href="../h_src/57528992.htm" class="macro">LUA_VTHREAD</a>: return &amp;<a href="../h_src/57639156.htm" class="macro">gco2th</a>(<a href="../h_src/57826072.htm" class="localvar">o</a>)-&gt;<a href="../h_src/57642080.htm" class="variable">gclist</a>;
   131 :    case <a href="../h_src/57517636.htm" class="macro">LUA_VPROTO</a>: return &amp;<a href="../h_src/57639292.htm" class="macro">gco2p</a>(<a href="../h_src/57826072.htm" class="localvar">o</a>)-&gt;<a href="../h_src/57513896.htm" class="variable">gclist</a>;
   135 :    return &amp;<a href="../h_src/57825936.htm" class="localvar">u</a>-&gt;<a href="../h_src/57519472.htm" class="variable">gclist</a>;
   306 :    if (<a href="../h_src/57631540.htm" class="macro">upisopen</a>(<a href="../h_src/57821312.htm" class="localvar">uv</a>))
   310 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57821584.htm" class="localvar">g</a>, <a href="../h_src/57821312.htm" class="localvar">uv</a>-&gt;<a href="../h_src/57510564.htm" class="variable">v</a>.<a href="../h_src/57510768.htm" class="variable">p</a>);  <a  class="comments">/* mark its content */</a>
   369 :    <a href="../h_src/57444252.htm" class="type">lua_State</a> **<a href="../h_src/57819612.htm" class="localvar">p</a> = &amp;<a href="../h_src/57819952.htm" class="localvar">g</a>-&gt;<a href="../h_src/57643984.htm" class="variable">twups</a>;
   374 :    <a href="../h_src/57819612.htm" class="localvar">p</a> = &amp;<a href="../h_src/57819816.htm" class="localvar">thread</a>-&gt;<a href="../h_src/57642012.htm" class="variable">twups</a>;  <a  class="comments">/* keep marked thread with upvalues in the list */</a>
   385 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57819952.htm" class="localvar">g</a>, <a href="../h_src/57819340.htm" class="localvar">uv</a>-&gt;<a href="../h_src/57510564.htm" class="variable">v</a>.<a href="../h_src/57510768.htm" class="variable">p</a>);  <a  class="comments">/* mark its value */</a>
   406 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57818796.htm" class="localvar">g</a>, &amp;<a href="../h_src/57818796.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646296.htm" class="variable">l_registry</a>);
   406 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57818796.htm" class="localvar">g</a>, &amp;<a href="../h_src/57818796.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646296.htm" class="variable">l_registry</a>);
   452 :    if (<a href="../h_src/57530488.htm" class="macro">isempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57817844.htm" class="localvar">n</a>)))  <a  class="comments">/* entry is empty? */</a>
   457 :    if (!<a href="../h_src/57817572.htm" class="localvar">hasclears</a> &amp;&amp; <a href="../h_src/57824712.htm" class="function">iscleared</a>(<a href="../h_src/57818116.htm" class="localvar">g</a>, <a href="../h_src/57827432.htm" class="macro">gcvalueN</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57817844.htm" class="localvar">n</a>))))  <a  class="comments">/* a white value? */</a>
   462 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57817980.htm" class="localvar">h</a>, <a href="../h_src/57818116.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644936.htm" class="variable">weak</a>);  <a  class="comments">/* has to be cleared later */</a>
   464 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57817980.htm" class="localvar">h</a>, <a href="../h_src/57818116.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);  <a  class="comments">/* must retraverse it in atomic phase */</a>
   498 :    if (<a href="../h_src/57530488.htm" class="macro">isempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57976052.htm" class="localvar">n</a>)))  <a  class="comments">/* entry is empty? */</a>
   502 :    if (<a href="../h_src/57827704.htm" class="macro">valiswhite</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57976052.htm" class="localvar">n</a>)))  <a  class="comments">/* value not marked yet? */</a><a href="../h_src/57528040.htm" class="variable">marked</a> yet? */
   505 :    else if (<a href="../h_src/57827704.htm" class="macro">valiswhite</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57976052.htm" class="localvar">n</a>))) {  <a  class="comments">/* value not marked yet? */</a><a href="../h_src/57528040.htm" class="variable">marked</a> yet? */
   507 :    <a href="../h_src/57826752.htm" class="function">reallymarkobject</a>(<a href="../h_src/57977276.htm" class="localvar">g</a>, <a href="../h_src/57527496.htm" class="macro">gcvalue</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57976052.htm" class="localvar">n</a>)));  <a  class="comments">/* mark it now */</a>
   512 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57977140.htm" class="localvar">h</a>, <a href="../h_src/57977276.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);  <a  class="comments">/* must retraverse it in atomic phase */</a>
   514 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57977140.htm" class="localvar">h</a>, <a href="../h_src/57977276.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644868.htm" class="variable">ephemeron</a>);  <a  class="comments">/* have to propagate again */</a>
   516 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57977140.htm" class="localvar">h</a>, <a href="../h_src/57977276.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644800.htm" class="variable">allweak</a>);  <a  class="comments">/* may have to clean white keys */</a>
   528 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57975780.htm" class="localvar">g</a>, &amp;<a href="../h_src/57975644.htm" class="localvar">h</a>-&gt;<a href="../h_src/57504716.htm" class="variable">array</a>[<a href="../h_src/57975236.htm" class="localvar">i</a>]);
   530 :    if (<a href="../h_src/57530488.htm" class="macro">isempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57975508.htm" class="localvar">n</a>)))  <a  class="comments">/* entry is empty? */</a>
   535 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57975780.htm" class="localvar">g</a>, <a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57975508.htm" class="localvar">n</a>));
   535 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57975780.htm" class="localvar">g</a>, <a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57975508.htm" class="localvar">n</a>));
   544 :    const <a href="../h_src/57535384.htm" class="type">TValue</a> *<a href="../h_src/57974284.htm" class="localvar">mode</a> = <a href="../h_src/57498664.htm" class="macro">gfasttm</a>(<a href="../h_src/57974828.htm" class="localvar">g</a>, <a href="../h_src/57974692.htm" class="localvar">h</a>-&gt;<a href="../h_src/57504444.htm" class="variable">metatable</a>, <a href="../h_src/57500704.htm" class="variable">TM_MODE</a>);
   555 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57974692.htm" class="localvar">h</a>, <a href="../h_src/57974828.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644800.htm" class="variable">allweak</a>);  <a  class="comments">/* nothing to traverse now */</a>
   567 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57974012.htm" class="localvar">g</a>, &amp;<a href="../h_src/57973876.htm" class="localvar">u</a>-&gt;<a href="../h_src/57519336.htm" class="variable">uv</a>[<a href="../h_src/57973740.htm" class="localvar">i</a>].<a href="../h_src/57520764.htm" class="variable">uv</a>);
   567 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57974012.htm" class="localvar">g</a>, &amp;<a href="../h_src/57973876.htm" class="localvar">u</a>-&gt;<a href="../h_src/57519336.htm" class="variable">uv</a>[<a href="../h_src/57973740.htm" class="localvar">i</a>].<a href="../h_src/57520764.htm" class="variable">uv</a>);
   582 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57973468.htm" class="localvar">g</a>, &amp;<a href="../h_src/57973332.htm" class="localvar">f</a>-&gt;<a href="../h_src/57515052.htm" class="variable">k</a>[<a href="../h_src/57973196.htm" class="localvar">i</a>]);
   596 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57972924.htm" class="localvar">g</a>, &amp;<a href="../h_src/57972788.htm" class="localvar">cl</a>-&gt;<a href="../h_src/57508796.htm" class="variable">upvalue</a>[<a href="../h_src/57972652.htm" class="localvar">i</a>]);
   631 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57971564.htm" class="localvar">th</a>, <a href="../h_src/57971700.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);  <a  class="comments">/* insert into 'grayagain' list */</a>
   637 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57971700.htm" class="localvar">g</a>, <a href="../h_src/57531712.htm" class="macro">s2v</a>(<a href="../h_src/57971292.htm" class="localvar">o</a>));
   637 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57971700.htm" class="localvar">g</a>, <a href="../h_src/57531712.htm" class="macro">s2v</a>(<a href="../h_src/57971292.htm" class="localvar">o</a>));
   642 :    <a href="../h_src/57530896.htm" class="macro">setnilvalue</a>(<a href="../h_src/57531712.htm" class="macro">s2v</a>(<a href="../h_src/57971292.htm" class="localvar">o</a>));  <a  class="comments">/* clear dead stack slice */</a>
   730 :    <a href="../h_src/57530216.htm" class="macro">setempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57968708.htm" class="localvar">n</a>));  <a  class="comments">/* remove entry */</a>
   731 :    if (<a href="../h_src/57530488.htm" class="macro">isempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57968708.htm" class="localvar">n</a>)))  <a  class="comments">/* is entry empty? */</a>
   754 :    if (<a href="../h_src/57824712.htm" class="function">iscleared</a>(<a href="../h_src/57968436.htm" class="localvar">g</a>, <a href="../h_src/57827432.htm" class="macro">gcvalueN</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57967892.htm" class="localvar">n</a>))))  <a  class="comments">/* unmarked value? */</a>
   755 :    <a href="../h_src/57530216.htm" class="macro">setempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57967892.htm" class="localvar">n</a>));  <a  class="comments">/* remove entry */</a>
   756 :    if (<a href="../h_src/57530488.htm" class="macro">isempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57967892.htm" class="localvar">n</a>)))  <a  class="comments">/* is entry empty? */</a>
   764 :    if (<a href="../h_src/57631540.htm" class="macro">upisopen</a>(<a href="../h_src/57966940.htm" class="localvar">uv</a>))
   837 :    <a href="../h_src/57965444.htm" class="localvar">p</a> = &amp;<a href="../h_src/57964492.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>;  <a  class="comments">/* go to next element */</a>
   918 :    <a href="../h_src/57533412.htm" class="macro">setobj2s</a>(<a href="../h_src/57962180.htm" class="localvar">L</a>, <a href="../h_src/57962180.htm" class="localvar">L</a>-&gt;<a href="../h_src/57642624.htm" class="variable">top</a>.<a href="../h_src/57531984.htm" class="variable">p</a>++, <a href="../h_src/57961908.htm" class="localvar">tm</a>);  <a  class="comments">/* push finalizer... */</a>
   919 :    <a href="../h_src/57533412.htm" class="macro">setobj2s</a>(<a href="../h_src/57962180.htm" class="localvar">L</a>, <a href="../h_src/57962180.htm" class="localvar">L</a>-&gt;<a href="../h_src/57642624.htm" class="variable">top</a>.<a href="../h_src/57531984.htm" class="variable">p</a>++, &amp;<a href="../h_src/57961772.htm" class="localvar">v</a>);  <a  class="comments">/* ... and its argument */</a>
   960 :    <a href="../h_src/57959188.htm" class="localvar">p</a> = &amp;(*<a href="../h_src/57959188.htm" class="localvar">p</a>)-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>;
   974 :    <a href="../h_src/57527972.htm" class="type">GCObject</a> **<a href="../h_src/57958508.htm" class="localvar">p</a> = &amp;<a href="../h_src/57958916.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645140.htm" class="variable">finobj</a>;
   975 :    <a href="../h_src/57527972.htm" class="type">GCObject</a> **<a href="../h_src/57958372.htm" class="localvar">lastnext</a> = <a href="../h_src/57959324.htm" class="function">findlast</a>(&amp;<a href="../h_src/57958916.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644732.htm" class="variable">tobefnz</a>);
   979 :    <a href="../h_src/57958508.htm" class="localvar">p</a> = &amp;<a href="../h_src/57958644.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>;  <a  class="comments">/* don't bother with it */</a>
   986 :    <a href="../h_src/57958372.htm" class="localvar">lastnext</a> = &amp;<a href="../h_src/57958644.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>;
  1006 :    <a href="../h_src/57958236.htm" class="function">checkpointer</a>(&amp;<a href="../h_src/57957692.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644596.htm" class="variable">survival</a>, <a href="../h_src/57957556.htm" class="localvar">o</a>);
  1007 :    <a href="../h_src/57958236.htm" class="function">checkpointer</a>(&amp;<a href="../h_src/57957692.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644528.htm" class="variable">old1</a>, <a href="../h_src/57957556.htm" class="localvar">o</a>);
  1008 :    <a href="../h_src/57958236.htm" class="function">checkpointer</a>(&amp;<a href="../h_src/57957692.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644460.htm" class="variable">reallyold</a>, <a href="../h_src/57957556.htm" class="localvar">o</a>);
  1009 :    <a href="../h_src/57958236.htm" class="function">checkpointer</a>(&amp;<a href="../h_src/57957692.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644392.htm" class="variable">firstold1</a>, <a href="../h_src/57957556.htm" class="localvar">o</a>);
  1020 :    <a href="../h_src/57498664.htm" class="macro">gfasttm</a>(<a href="../h_src/57957012.htm" class="localvar">g</a>, <a href="../h_src/57957148.htm" class="localvar">mt</a>, <a href="../h_src/57500772.htm" class="variable">TM_GC</a>) == NULL ||    <a  class="comments">/* or has no finalizer... */</a>
  1027 :    if (<a href="../h_src/57957012.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645208.htm" class="variable">sweepgc</a> == &amp;<a href="../h_src/57957284.htm" class="localvar">o</a>-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>)  <a  class="comments">/* should not remove 'sweepgc' object */</a>
  1033 :    for (<a href="../h_src/57956876.htm" class="localvar">p</a> = &amp;<a href="../h_src/57957012.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645344.htm" class="variable">allgc</a>; *<a href="../h_src/57956876.htm" class="localvar">p</a> != <a href="../h_src/57957284.htm" class="localvar">o</a>; <a href="../h_src/57956876.htm" class="localvar">p</a> = &amp;(*<a href="../h_src/57956876.htm" class="localvar">p</a>)-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>) { <a  class="comments">/* empty */</a> }
  1033 :    for (<a href="../h_src/57956876.htm" class="localvar">p</a> = &amp;<a href="../h_src/57957012.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645344.htm" class="variable">allgc</a>; *<a href="../h_src/57956876.htm" class="localvar">p</a> != <a href="../h_src/57957284.htm" class="localvar">o</a>; <a href="../h_src/57956876.htm" class="localvar">p</a> = &amp;(*<a href="../h_src/57956876.htm" class="localvar">p</a>)-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>) { <a  class="comments">/* empty */</a> }
  1090 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57955244.htm" class="localvar">th</a>, <a href="../h_src/57955380.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);  <a  class="comments">/* insert into 'grayagain' list */</a>
  1092 :    else if (<a href="../h_src/57955516.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528108.htm" class="variable">tt</a> == <a href="../h_src/57513760.htm" class="macro">LUA_VUPVAL</a> &amp;&amp; <a href="../h_src/57631540.htm" class="macro">upisopen</a>(<a href="../h_src/57639020.htm" class="macro">gco2upv</a>(<a href="../h_src/57955516.htm" class="localvar">curr</a>)))
  1096 :    <a href="../h_src/57955652.htm" class="localvar">p</a> = &amp;<a href="../h_src/57955516.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>;  <a  class="comments">/* go to next element */</a>
  1142 :    <a href="../h_src/57954700.htm" class="localvar">p</a> = &amp;<a href="../h_src/57954020.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>;  <a  class="comments">/* go to next element */</a>
  1204 :    <a href="../h_src/57527972.htm" class="type">GCObject</a> **<a href="../h_src/57952388.htm" class="localvar">list</a> = <a href="../h_src/57953204.htm" class="function">correctgraylist</a>(&amp;<a href="../h_src/57952524.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);
  1263 :    <a href="../h_src/57950756.htm" class="localvar">psurvival</a> = <a href="../h_src/57955108.htm" class="function">sweepgen</a>(<a href="../h_src/57951028.htm" class="localvar">L</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>, &amp;<a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645344.htm" class="variable">allgc</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644596.htm" class="variable">survival</a>, &amp;<a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644392.htm" class="variable">firstold1</a>);
  1263 :    <a href="../h_src/57950756.htm" class="localvar">psurvival</a> = <a href="../h_src/57955108.htm" class="function">sweepgen</a>(<a href="../h_src/57951028.htm" class="localvar">L</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>, &amp;<a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645344.htm" class="variable">allgc</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644596.htm" class="variable">survival</a>, &amp;<a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644392.htm" class="variable">firstold1</a>);
  1265 :    <a href="../h_src/57955108.htm" class="function">sweepgen</a>(<a href="../h_src/57951028.htm" class="localvar">L</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>, <a href="../h_src/57950756.htm" class="localvar">psurvival</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644528.htm" class="variable">old1</a>, &amp;<a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644392.htm" class="variable">firstold1</a>);
  1272 :    <a href="../h_src/57950756.htm" class="localvar">psurvival</a> = <a href="../h_src/57955108.htm" class="function">sweepgen</a>(<a href="../h_src/57951028.htm" class="localvar">L</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>, &amp;<a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645140.htm" class="variable">finobj</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644324.htm" class="variable">finobjsur</a>, &amp;<a href="../h_src/57950620.htm" class="localvar">dummy</a>);
  1279 :    <a href="../h_src/57955108.htm" class="function">sweepgen</a>(<a href="../h_src/57951028.htm" class="localvar">L</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>, &amp;<a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644732.htm" class="variable">tobefnz</a>, NULL, &amp;<a href="../h_src/57950620.htm" class="localvar">dummy</a>);
  1294 :    <a href="../h_src/57955924.htm" class="function">sweep2old</a>(<a href="../h_src/57950348.htm" class="localvar">L</a>, &amp;<a href="../h_src/57950212.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645344.htm" class="variable">allgc</a>);
  1300 :    <a href="../h_src/57955924.htm" class="function">sweep2old</a>(<a href="../h_src/57950348.htm" class="localvar">L</a>, &amp;<a href="../h_src/57950212.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645140.htm" class="variable">finobj</a>);
  1303 :    <a href="../h_src/57955924.htm" class="function">sweep2old</a>(<a href="../h_src/57950348.htm" class="localvar">L</a>, &amp;<a href="../h_src/57950212.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644732.htm" class="variable">tobefnz</a>);
  1488 :    <a href="../h_src/57946540.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645208.htm" class="variable">sweepgc</a> = <a href="../h_src/57964220.htm" class="function">sweeptolive</a>(<a href="../h_src/57946676.htm" class="localvar">L</a>, &amp;<a href="../h_src/57946540.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645344.htm" class="variable">allgc</a>);
  1534 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57945316.htm" class="localvar">g</a>, &amp;<a href="../h_src/57945316.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646296.htm" class="variable">l_registry</a>);
  1534 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57945316.htm" class="localvar">g</a>, &amp;<a href="../h_src/57945316.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646296.htm" class="variable">l_registry</a>);
  1611 :    <a href="../h_src/57943276.htm" class="localvar">work</a> = <a href="../h_src/57944636.htm" class="function">sweepstep</a>(<a href="../h_src/57943548.htm" class="localvar">L</a>, <a href="../h_src/57943412.htm" class="localvar">g</a>, <a href="../h_src/57629228.htm" class="macro">GCSswpfinobj</a>, &amp;<a href="../h_src/57943412.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645140.htm" class="variable">finobj</a>);
  1615 :    <a href="../h_src/57943276.htm" class="localvar">work</a> = <a href="../h_src/57944636.htm" class="function">sweepstep</a>(<a href="../h_src/57943548.htm" class="localvar">L</a>, <a href="../h_src/57943412.htm" class="localvar">g</a>, <a href="../h_src/57629092.htm" class="macro">GCSswptobefnz</a>, &amp;<a href="../h_src/57943412.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644732.htm" class="variable">tobefnz</a>);
</pre>
<pre>
</pre>
<h5>Conversion Issue</h5>
<pre>
   127 :    case <a href="../h_src/57507436.htm" class="macro">LUA_VTABLE</a>: return &amp;<a href="../h_src/57639428.htm" class="macro">gco2t</a>(<a href="../h_src/57826072.htm" class="localvar">o</a>)-&gt;<a href="../h_src/57504376.htm" class="variable">gclist</a>;
   128 :    case <a href="../h_src/57513624.htm" class="macro">LUA_VLCL</a>: return &amp;<a href="../h_src/57639836.htm" class="macro">gco2lcl</a>(<a href="../h_src/57826072.htm" class="localvar">o</a>)-&gt;<a href="../h_src/57508252.htm" class="variable">gclist</a>;
   129 :    case <a href="../h_src/57513352.htm" class="macro">LUA_VCCL</a>: return &amp;<a href="../h_src/57639700.htm" class="macro">gco2ccl</a>(<a href="../h_src/57826072.htm" class="localvar">o</a>)-&gt;<a href="../h_src/57509000.htm" class="variable">gclist</a>;
   130 :    case <a href="../h_src/57528992.htm" class="macro">LUA_VTHREAD</a>: return &amp;<a href="../h_src/57639156.htm" class="macro">gco2th</a>(<a href="../h_src/57826072.htm" class="localvar">o</a>)-&gt;<a href="../h_src/57642080.htm" class="variable">gclist</a>;
   131 :    case <a href="../h_src/57517636.htm" class="macro">LUA_VPROTO</a>: return &amp;<a href="../h_src/57639292.htm" class="macro">gco2p</a>(<a href="../h_src/57826072.htm" class="localvar">o</a>)-&gt;<a href="../h_src/57513896.htm" class="variable">gclist</a>;
   133 :    <a href="../h_src/57519268.htm" class="type">Udata</a> *<a href="../h_src/57825936.htm" class="localvar">u</a> = <a href="../h_src/57639972.htm" class="macro">gco2u</a>(<a href="../h_src/57826072.htm" class="localvar">o</a>);
   152 :    <a href="../h_src/57827976.htm" class="macro">set2gray</a>(<a href="../h_src/57825528.htm" class="localvar">o</a>);  <a  class="comments">/* now it is */</a>
   174 :    <a href="../h_src/57502744.htm" class="macro">setdeadkey</a>(<a href="../h_src/57824848.htm" class="localvar">n</a>);  <a  class="comments">/* unused key; remove it */</a>
   188 :    <a href="../h_src/57827024.htm" class="macro">markobject</a>(<a href="../h_src/57824576.htm" class="localvar">g</a>, <a href="../h_src/57824440.htm" class="localvar">o</a>);  <a  class="comments">/* strings are 'values', so are never weak */</a>
   235 :    <a href="../h_src/57827976.htm" class="macro">set2gray</a>(<a href="../h_src/57823624.htm" class="localvar">o</a>);  <a  class="comments">/* make it gray to become touched1 */</a>
   237 :    <a href="../h_src/57825120.htm" class="macro">linkobjgclist</a>(<a href="../h_src/57823624.htm" class="localvar">o</a>, <a href="../h_src/57823488.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);
   246 :    <a href="../h_src/57827976.htm" class="macro">set2gray</a>(<a href="../h_src/57823216.htm" class="localvar">o</a>);  <a  class="comments">/* they will be gray forever */</a>
   261 :    <a href="../h_src/57527972.htm" class="type">GCObject</a> *<a href="../h_src/57822128.htm" class="localvar">o</a> = <a href="../h_src/57547760.htm" class="macro">cast</a>(<a href="../h_src/57527972.htm" class="type">GCObject</a> *, <a href="../h_src/57822264.htm" class="localvar">p</a> + <a href="../h_src/57822536.htm" class="localvar">offset</a>);
   263 :    <a href="../h_src/57822128.htm" class="localvar">o</a>-&gt;<a href="../h_src/57528108.htm" class="variable">tt</a> = <a href="../h_src/57822808.htm" class="localvar">tt</a>;
   305 :    <a href="../h_src/57509612.htm" class="type">UpVal</a> *<a href="../h_src/57821312.htm" class="localvar">uv</a> = <a href="../h_src/57639020.htm" class="macro">gco2upv</a>(<a href="../h_src/57821448.htm" class="localvar">o</a>);
   307 :    <a href="../h_src/57827976.htm" class="macro">set2gray</a>(<a href="../h_src/57821312.htm" class="localvar">uv</a>);  <a  class="comments">/* open upvalues are kept gray */</a>
   314 :    <a href="../h_src/57519268.htm" class="type">Udata</a> *<a href="../h_src/57821176.htm" class="localvar">u</a> = <a href="../h_src/57639972.htm" class="macro">gco2u</a>(<a href="../h_src/57821448.htm" class="localvar">o</a>);
   316 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57821584.htm" class="localvar">g</a>, <a href="../h_src/57821176.htm" class="localvar">u</a>-&gt;<a href="../h_src/57519540.htm" class="variable">metatable</a>);  <a  class="comments">/* mark its metatable */</a>
   324 :    <a href="../h_src/57825120.htm" class="macro">linkobjgclist</a>(<a href="../h_src/57821448.htm" class="localvar">o</a>, <a href="../h_src/57821584.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645072.htm" class="variable">gray</a>);  <a  class="comments">/* to be visited later */</a>
   338 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57820904.htm" class="localvar">g</a>, <a href="../h_src/57820904.htm" class="localvar">g</a>-&gt;<a href="../h_src/57643440.htm" class="variable">mt</a>[<a href="../h_src/57820768.htm" class="localvar">i</a>]);
   350 :    <a href="../h_src/57827024.htm" class="macro">markobject</a>(<a href="../h_src/57820496.htm" class="localvar">g</a>, <a href="../h_src/57820360.htm" class="localvar">o</a>);
   405 :    <a href="../h_src/57827024.htm" class="macro">markobject</a>(<a href="../h_src/57818796.htm" class="localvar">g</a>, <a href="../h_src/57818796.htm" class="localvar">g</a>-&gt;<a href="../h_src/57643848.htm" class="variable">mainthread</a>);
   433 :    <a href="../h_src/57825120.htm" class="macro">linkobjgclist</a>(<a href="../h_src/57818388.htm" class="localvar">o</a>, <a href="../h_src/57818524.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);  <a  class="comments">/* link it back in 'grayagain' */</a>
   436 :    <a href="../h_src/57623516.htm" class="macro">changeage</a>(<a href="../h_src/57818388.htm" class="localvar">o</a>, <a href="../h_src/57624196.htm" class="macro">G_TOUCHED2</a>, <a href="../h_src/57624468.htm" class="macro">G_OLD</a>);  <a  class="comments">/* advance age */</a>
   447 :    <a href="../h_src/57506008.htm" class="type">Node</a> *<a href="../h_src/57817844.htm" class="localvar">n</a>, *<a href="../h_src/57817708.htm" class="localvar">limit</a> = <a href="../h_src/57826344.htm" class="macro">gnodelast</a>(<a href="../h_src/57817980.htm" class="localvar">h</a>);
   462 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57817980.htm" class="localvar">h</a>, <a href="../h_src/57818116.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644936.htm" class="variable">weak</a>);  <a  class="comments">/* has to be cleared later */</a>
   464 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57817980.htm" class="localvar">h</a>, <a href="../h_src/57818116.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);  <a  class="comments">/* must retraverse it in atomic phase */</a>
   512 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57977140.htm" class="localvar">h</a>, <a href="../h_src/57977276.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);  <a  class="comments">/* must retraverse it in atomic phase */</a>
   514 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57977140.htm" class="localvar">h</a>, <a href="../h_src/57977276.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644868.htm" class="variable">ephemeron</a>);  <a  class="comments">/* have to propagate again */</a>
   516 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57977140.htm" class="localvar">h</a>, <a href="../h_src/57977276.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644800.htm" class="variable">allweak</a>);  <a  class="comments">/* may have to clean white keys */</a>
   518 :    <a href="../h_src/57818660.htm" class="function">genlink</a>(<a href="../h_src/57977276.htm" class="localvar">g</a>, <a href="../h_src/57638884.htm" class="macro">obj2gco</a>(<a href="../h_src/57977140.htm" class="localvar">h</a>));  <a  class="comments">/* check whether collector still needs to see it */</a>
   524 :    <a href="../h_src/57506008.htm" class="type">Node</a> *<a href="../h_src/57975508.htm" class="localvar">n</a>, *<a href="../h_src/57975372.htm" class="localvar">limit</a> = <a href="../h_src/57826344.htm" class="macro">gnodelast</a>(<a href="../h_src/57975644.htm" class="localvar">h</a>);
   538 :    <a href="../h_src/57818660.htm" class="function">genlink</a>(<a href="../h_src/57975780.htm" class="localvar">g</a>, <a href="../h_src/57638884.htm" class="macro">obj2gco</a>(<a href="../h_src/57975644.htm" class="localvar">h</a>));
   545 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57974828.htm" class="localvar">g</a>, <a href="../h_src/57974692.htm" class="localvar">h</a>-&gt;<a href="../h_src/57504444.htm" class="variable">metatable</a>);
   547 :    (<a href="../h_src/57547624.htm" class="macro">cast_void</a>(<a href="../h_src/57974556.htm" class="localvar">weakkey</a> = <a href="../h_aa/57565916.htm" class="libfunc">strchr</a>(<a href="../h_src/57522532.htm" class="macro">svalue</a>(<a href="../h_src/57974284.htm" class="localvar">mode</a>), 'k')),
   547 :    (<a href="../h_src/57547624.htm" class="macro">cast_void</a>(<a href="../h_src/57974556.htm" class="localvar">weakkey</a> = <a href="../h_aa/57565916.htm" class="libfunc">strchr</a>(<a href="../h_src/57522532.htm" class="macro">svalue</a>(<a href="../h_src/57974284.htm" class="localvar">mode</a>), 'k')),
   548 :    <a href="../h_src/57547624.htm" class="macro">cast_void</a>(<a href="../h_src/57974420.htm" class="localvar">weakvalue</a> = <a href="../h_aa/57565916.htm" class="libfunc">strchr</a>(<a href="../h_src/57522532.htm" class="macro">svalue</a>(<a href="../h_src/57974284.htm" class="localvar">mode</a>), 'v')),
   548 :    <a href="../h_src/57547624.htm" class="macro">cast_void</a>(<a href="../h_src/57974420.htm" class="localvar">weakvalue</a> = <a href="../h_aa/57565916.htm" class="libfunc">strchr</a>(<a href="../h_src/57522532.htm" class="macro">svalue</a>(<a href="../h_src/57974284.htm" class="localvar">mode</a>), 'v')),
   555 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57974692.htm" class="localvar">h</a>, <a href="../h_src/57974828.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644800.htm" class="variable">allweak</a>);  <a  class="comments">/* nothing to traverse now */</a>
   565 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57974012.htm" class="localvar">g</a>, <a href="../h_src/57973876.htm" class="localvar">u</a>-&gt;<a href="../h_src/57519540.htm" class="variable">metatable</a>);  <a  class="comments">/* mark its metatable */</a>
   568 :    <a href="../h_src/57818660.htm" class="function">genlink</a>(<a href="../h_src/57974012.htm" class="localvar">g</a>, <a href="../h_src/57638884.htm" class="macro">obj2gco</a>(<a href="../h_src/57973876.htm" class="localvar">u</a>));
   580 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57973468.htm" class="localvar">g</a>, <a href="../h_src/57973332.htm" class="localvar">f</a>-&gt;<a href="../h_src/57513964.htm" class="variable">source</a>);
   584 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57973468.htm" class="localvar">g</a>, <a href="../h_src/57973332.htm" class="localvar">f</a>-&gt;<a href="../h_src/57514440.htm" class="variable">upvalues</a>[<a href="../h_src/57973196.htm" class="localvar">i</a>].<a href="../h_src/57517364.htm" class="variable">name</a>);
   586 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57973468.htm" class="localvar">g</a>, <a href="../h_src/57973332.htm" class="localvar">f</a>-&gt;<a href="../h_src/57514576.htm" class="variable">p</a>[<a href="../h_src/57973196.htm" class="localvar">i</a>]);
   588 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57973468.htm" class="localvar">g</a>, <a href="../h_src/57973332.htm" class="localvar">f</a>-&gt;<a href="../h_src/57514032.htm" class="variable">locvars</a>[<a href="../h_src/57973196.htm" class="localvar">i</a>].<a href="../h_src/57516888.htm" class="variable">varname</a>);
   606 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57972380.htm" class="localvar">g</a>, <a href="../h_src/57972244.htm" class="localvar">cl</a>-&gt;<a href="../h_src/57508184.htm" class="variable">p</a>);  <a  class="comments">/* mark its prototype */</a>
   609 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57972380.htm" class="localvar">g</a>, <a href="../h_src/57971972.htm" class="localvar">uv</a>);  <a  class="comments">/* mark upvalue */</a>
   631 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57971564.htm" class="localvar">th</a>, <a href="../h_src/57971700.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);  <a  class="comments">/* insert into 'grayagain' list */</a>
   639 :    <a href="../h_src/57827024.htm" class="macro">markobject</a>(<a href="../h_src/57971700.htm" class="localvar">g</a>, <a href="../h_src/57971428.htm" class="localvar">uv</a>);  <a  class="comments">/* open upvalues cannot be collected */</a>
   642 :    <a href="../h_src/57530896.htm" class="macro">setnilvalue</a>(<a href="../h_src/57531712.htm" class="macro">s2v</a>(<a href="../h_src/57971292.htm" class="localvar">o</a>));  <a  class="comments">/* clear dead stack slice */</a>
   660 :    <a href="../h_src/57625284.htm" class="macro">nw2black</a>(<a href="../h_src/57970884.htm" class="localvar">o</a>);
   663 :    case <a href="../h_src/57507436.htm" class="macro">LUA_VTABLE</a>: return <a href="../h_src/57974964.htm" class="function">traversetable</a>(<a href="../h_src/57971020.htm" class="localvar">g</a>, <a href="../h_src/57639428.htm" class="macro">gco2t</a>(<a href="../h_src/57970884.htm" class="localvar">o</a>));
   664 :    case <a href="../h_src/57521988.htm" class="macro">LUA_VUSERDATA</a>: return <a href="../h_src/57974148.htm" class="function">traverseudata</a>(<a href="../h_src/57971020.htm" class="localvar">g</a>, <a href="../h_src/57639972.htm" class="macro">gco2u</a>(<a href="../h_src/57970884.htm" class="localvar">o</a>));
   665 :    case <a href="../h_src/57513624.htm" class="macro">LUA_VLCL</a>: return <a href="../h_src/57972516.htm" class="function">traverseLclosure</a>(<a href="../h_src/57971020.htm" class="localvar">g</a>, <a href="../h_src/57639836.htm" class="macro">gco2lcl</a>(<a href="../h_src/57970884.htm" class="localvar">o</a>));
   666 :    case <a href="../h_src/57513352.htm" class="macro">LUA_VCCL</a>: return <a href="../h_src/57973060.htm" class="function">traverseCclosure</a>(<a href="../h_src/57971020.htm" class="localvar">g</a>, <a href="../h_src/57639700.htm" class="macro">gco2ccl</a>(<a href="../h_src/57970884.htm" class="localvar">o</a>));
   667 :    case <a href="../h_src/57517636.htm" class="macro">LUA_VPROTO</a>: return <a href="../h_src/57973604.htm" class="function">traverseproto</a>(<a href="../h_src/57971020.htm" class="localvar">g</a>, <a href="../h_src/57639292.htm" class="macro">gco2p</a>(<a href="../h_src/57970884.htm" class="localvar">o</a>));
   668 :    case <a href="../h_src/57528992.htm" class="macro">LUA_VTHREAD</a>: return <a href="../h_src/57971836.htm" class="function">traversethread</a>(<a href="../h_src/57971020.htm" class="localvar">g</a>, <a href="../h_src/57639156.htm" class="macro">gco2th</a>(<a href="../h_src/57970884.htm" class="localvar">o</a>));
   698 :    <a href="../h_src/57504308.htm" class="type">Table</a> *<a href="../h_src/57969524.htm" class="localvar">h</a> = <a href="../h_src/57639428.htm" class="macro">gco2t</a>(<a href="../h_src/57969796.htm" class="localvar">w</a>);
   700 :    <a href="../h_src/57625284.htm" class="macro">nw2black</a>(<a href="../h_src/57969524.htm" class="localvar">h</a>);  <a  class="comments">/* out of the list (for now) */</a>
   724 :    for (; <a href="../h_src/57969116.htm" class="localvar">l</a>; <a href="../h_src/57969116.htm" class="localvar">l</a> = <a href="../h_src/57639428.htm" class="macro">gco2t</a>(<a href="../h_src/57969116.htm" class="localvar">l</a>)-&gt;<a href="../h_src/57504376.htm" class="variable">gclist</a>) {
   725 :    <a href="../h_src/57504308.htm" class="type">Table</a> *<a href="../h_src/57968980.htm" class="localvar">h</a> = <a href="../h_src/57639428.htm" class="macro">gco2t</a>(<a href="../h_src/57969116.htm" class="localvar">l</a>);
   726 :    <a href="../h_src/57506008.htm" class="type">Node</a> *<a href="../h_src/57968844.htm" class="localvar">limit</a> = <a href="../h_src/57826344.htm" class="macro">gnodelast</a>(<a href="../h_src/57968980.htm" class="localvar">h</a>);
   730 :    <a href="../h_src/57530216.htm" class="macro">setempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57968708.htm" class="localvar">n</a>));  <a  class="comments">/* remove entry */</a>
   743 :    for (; <a href="../h_src/57968300.htm" class="localvar">l</a> != <a href="../h_src/57968164.htm" class="localvar">f</a>; <a href="../h_src/57968300.htm" class="localvar">l</a> = <a href="../h_src/57639428.htm" class="macro">gco2t</a>(<a href="../h_src/57968300.htm" class="localvar">l</a>)-&gt;<a href="../h_src/57504376.htm" class="variable">gclist</a>) {
   744 :    <a href="../h_src/57504308.htm" class="type">Table</a> *<a href="../h_src/57968028.htm" class="localvar">h</a> = <a href="../h_src/57639428.htm" class="macro">gco2t</a>(<a href="../h_src/57968300.htm" class="localvar">l</a>);
   745 :    <a href="../h_src/57506008.htm" class="type">Node</a> *<a href="../h_src/57967892.htm" class="localvar">n</a>, *<a href="../h_src/57967756.htm" class="localvar">limit</a> = <a href="../h_src/57826344.htm" class="macro">gnodelast</a>(<a href="../h_src/57968028.htm" class="localvar">h</a>);
   751 :    <a href="../h_src/57530216.htm" class="macro">setempty</a>(<a href="../h_src/57967348.htm" class="localvar">o</a>);  <a  class="comments">/* remove entry */</a>
   755 :    <a href="../h_src/57530216.htm" class="macro">setempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57967892.htm" class="localvar">n</a>));  <a  class="comments">/* remove entry */</a>
   773 :    <a href="../h_src/57630248.htm" class="function">luaF_freeproto</a>(<a href="../h_src/57966668.htm" class="localvar">L</a>, <a href="../h_src/57639292.htm" class="macro">gco2p</a>(<a href="../h_src/57966532.htm" class="localvar">o</a>));
   776 :    <a href="../h_src/57967212.htm" class="function">freeupval</a>(<a href="../h_src/57966668.htm" class="localvar">L</a>, <a href="../h_src/57639020.htm" class="macro">gco2upv</a>(<a href="../h_src/57966532.htm" class="localvar">o</a>));
   779 :    <a href="../h_src/57507980.htm" class="type">LClosure</a> *<a href="../h_src/57966396.htm" class="localvar">cl</a> = <a href="../h_src/57639836.htm" class="macro">gco2lcl</a>(<a href="../h_src/57966532.htm" class="localvar">o</a>);
   784 :    <a href="../h_src/57508728.htm" class="type">CClosure</a> *<a href="../h_src/57966260.htm" class="localvar">cl</a> = <a href="../h_src/57639700.htm" class="macro">gco2ccl</a>(<a href="../h_src/57966532.htm" class="localvar">o</a>);
   789 :    <a href="../h_src/57616308.htm" class="function">luaH_free</a>(<a href="../h_src/57966668.htm" class="localvar">L</a>, <a href="../h_src/57639428.htm" class="macro">gco2t</a>(<a href="../h_src/57966532.htm" class="localvar">o</a>));
   792 :    <a href="../h_src/57638544.htm" class="function">luaE_freethread</a>(<a href="../h_src/57966668.htm" class="localvar">L</a>, <a href="../h_src/57639156.htm" class="macro">gco2th</a>(<a href="../h_src/57966532.htm" class="localvar">o</a>));
   795 :    <a href="../h_src/57519268.htm" class="type">Udata</a> *<a href="../h_src/57966124.htm" class="localvar">u</a> = <a href="../h_src/57639972.htm" class="macro">gco2u</a>(<a href="../h_src/57966532.htm" class="localvar">o</a>);
   800 :    <a href="../h_src/57522736.htm" class="type">TString</a> *<a href="../h_src/57965988.htm" class="localvar">ts</a> = <a href="../h_src/57640108.htm" class="macro">gco2ts</a>(<a href="../h_src/57966532.htm" class="localvar">o</a>);
   806 :    <a href="../h_src/57522736.htm" class="type">TString</a> *<a href="../h_src/57965852.htm" class="localvar">ts</a> = <a href="../h_src/57640108.htm" class="macro">gco2ts</a>(<a href="../h_src/57966532.htm" class="localvar">o</a>);
   836 :    <a href="../h_src/57964492.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528040.htm" class="variable">marked</a> = <a href="../h_src/57546944.htm" class="macro">cast_byte</a>((<a href="../h_src/57964356.htm" class="localvar">marked</a> &amp; ~<a href="../h_src/57828248.htm" class="macro">maskgcbits</a>) | <a href="../h_src/57964628.htm" class="localvar">white</a>);
   890 :    <a href="../h_src/57627460.htm" class="macro">resetbit</a>(<a href="../h_src/57962860.htm" class="localvar">o</a>-&gt;<a href="../h_src/57528040.htm" class="variable">marked</a>, <a href="../h_src/57626780.htm" class="macro">FINALIZEDBIT</a>);  <a  class="comments">/* object is &quot;normal&quot; again */</a>
   920 :    <a href="../h_src/57962180.htm" class="localvar">L</a>-&gt;<a href="../h_src/57642420.htm" class="variable">ci</a>-&gt;<a href="../h_src/57649424.htm" class="variable">callstatus</a> |= <a href="../h_src/57648404.htm" class="macro">CIST_FIN</a>;  <a  class="comments">/* will run a finalizer */</a>
   921 :    <a href="../h_src/57961364.htm" class="localvar">status</a> = <a href="../h_src/57632968.htm" class="function">luaD_pcall</a>(<a href="../h_src/57962180.htm" class="localvar">L</a>, <a href="../h_src/57962724.htm" class="function">dothecall</a>, NULL, <a href="../h_src/57634396.htm" class="macro">savestack</a>(<a href="../h_src/57962180.htm" class="localvar">L</a>, <a href="../h_src/57962180.htm" class="localvar">L</a>-&gt;<a href="../h_src/57642624.htm" class="variable">top</a>.<a href="../h_src/57531984.htm" class="variable">p</a> - 2), 0);
   921 :    <a href="../h_src/57961364.htm" class="localvar">status</a> = <a href="../h_src/57632968.htm" class="function">luaD_pcall</a>(<a href="../h_src/57962180.htm" class="localvar">L</a>, <a href="../h_src/57962724.htm" class="function">dothecall</a>, NULL, <a href="../h_src/57634396.htm" class="macro">savestack</a>(<a href="../h_src/57962180.htm" class="localvar">L</a>, <a href="../h_src/57962180.htm" class="localvar">L</a>-&gt;<a href="../h_src/57642624.htm" class="variable">top</a>.<a href="../h_src/57531984.htm" class="variable">p</a> - 2), 0);
   922 :    <a href="../h_src/57962180.htm" class="localvar">L</a>-&gt;<a href="../h_src/57642420.htm" class="variable">ci</a>-&gt;<a href="../h_src/57649424.htm" class="variable">callstatus</a> &amp;= ~<a href="../h_src/57648404.htm" class="macro">CIST_FIN</a>;  <a  class="comments">/* not running a finalizer anymore */</a>
   924 :    <a href="../h_src/57962044.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645684.htm" class="variable">gcstp</a> = <a href="../h_src/57961092.htm" class="localvar">oldgcstp</a>;  <a  class="comments">/* restore state */</a>
  1037 :    <a href="../h_src/57627596.htm" class="macro">l_setbit</a>(<a href="../h_src/57957284.htm" class="localvar">o</a>-&gt;<a href="../h_src/57528040.htm" class="variable">marked</a>, <a href="../h_src/57626780.htm" class="macro">FINALIZEDBIT</a>);  <a  class="comments">/* mark it as such */</a>
  1062 :    <a href="../h_src/57956468.htm" class="localvar">threshold</a> = (<a href="../h_src/57956196.htm" class="localvar">pause</a> &lt; <a href="../h_src/57549936.htm" class="macro">MAX_LMEM</a> / <a href="../h_src/57956060.htm" class="localvar">estimate</a>)  <a  class="comments">/* overflow? */</a>
  1064 :    : <a href="../h_src/57549936.htm" class="macro">MAX_LMEM</a>;  <a  class="comments">/* overflow; truncate to maximum */</a>
  1065 :    <a href="../h_src/57956332.htm" class="localvar">debt</a> = <a href="../h_src/57638748.htm" class="macro">gettotalbytes</a>(<a href="../h_src/57956604.htm" class="localvar">g</a>) - <a href="../h_src/57956468.htm" class="localvar">threshold</a>;
  1065 :    <a href="../h_src/57956332.htm" class="localvar">debt</a> = <a href="../h_src/57638748.htm" class="macro">gettotalbytes</a>(<a href="../h_src/57956604.htm" class="localvar">g</a>) - <a href="../h_src/57956468.htm" class="localvar">threshold</a>;
  1089 :    <a href="../h_src/57444252.htm" class="type">lua_State</a> *<a href="../h_src/57955244.htm" class="localvar">th</a> = <a href="../h_src/57639156.htm" class="macro">gco2th</a>(<a href="../h_src/57955516.htm" class="localvar">curr</a>);
  1090 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57955244.htm" class="localvar">th</a>, <a href="../h_src/57955380.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);  <a  class="comments">/* insert into 'grayagain' list */</a>
  1092 :    else if (<a href="../h_src/57955516.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528108.htm" class="variable">tt</a> == <a href="../h_src/57513760.htm" class="macro">LUA_VUPVAL</a> &amp;&amp; <a href="../h_src/57631540.htm" class="macro">upisopen</a>(<a href="../h_src/57639020.htm" class="macro">gco2upv</a>(<a href="../h_src/57955516.htm" class="localvar">curr</a>)))
  1093 :    <a href="../h_src/57827976.htm" class="macro">set2gray</a>(<a href="../h_src/57955516.htm" class="localvar">curr</a>);  <a  class="comments">/* open upvalues are always gray */</a>
  1095 :    <a href="../h_src/57625284.htm" class="macro">nw2black</a>(<a href="../h_src/57955516.htm" class="localvar">curr</a>);
  1135 :    <a href="../h_src/57954020.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528040.htm" class="variable">marked</a> = <a href="../h_src/57546944.htm" class="macro">cast_byte</a>(<a href="../h_src/57953884.htm" class="localvar">marked</a> | <a href="../h_src/57624876.htm" class="macro">G_SURVIVAL</a> | <a href="../h_src/57954156.htm" class="localvar">white</a>);
  1178 :    <a href="../h_src/57625284.htm" class="macro">nw2black</a>(<a href="../h_src/57952932.htm" class="localvar">curr</a>);  <a  class="comments">/* make it black, for next barrier */</a>
  1179 :    <a href="../h_src/57623516.htm" class="macro">changeage</a>(<a href="../h_src/57952932.htm" class="localvar">curr</a>, <a href="../h_src/57624332.htm" class="macro">G_TOUCHED1</a>, <a href="../h_src/57624196.htm" class="macro">G_TOUCHED2</a>);
  1189 :    <a href="../h_src/57623516.htm" class="macro">changeage</a>(<a href="../h_src/57952932.htm" class="localvar">curr</a>, <a href="../h_src/57624196.htm" class="macro">G_TOUCHED2</a>, <a href="../h_src/57624468.htm" class="macro">G_OLD</a>);  <a  class="comments">/* ... to OLD */</a>
  1190 :    <a href="../h_src/57625284.htm" class="macro">nw2black</a>(<a href="../h_src/57952932.htm" class="localvar">curr</a>);  <a  class="comments">/* make object black (to be removed) */</a>
  1224 :    <a href="../h_src/57623516.htm" class="macro">changeage</a>(<a href="../h_src/57951708.htm" class="localvar">p</a>, <a href="../h_src/57624604.htm" class="macro">G_OLD1</a>, <a href="../h_src/57624468.htm" class="macro">G_OLD</a>);  <a  class="comments">/* now they are old */</a>
  1307 :    <a href="../h_src/57950212.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646500.htm" class="variable">GCestimate</a> = <a href="../h_src/57638748.htm" class="macro">gettotalbytes</a>(<a href="../h_src/57950212.htm" class="localvar">g</a>);  <a  class="comments">/* base for memory control */</a>
  1317 :    <a href="../h_src/57638612.htm" class="function">luaE_setdebt</a>(<a href="../h_src/57949940.htm" class="localvar">g</a>, -(<a href="../h_src/57547760.htm" class="macro">cast</a>(<a href="../h_src/57550548.htm" class="type">l_mem</a>, (<a href="../h_src/57638748.htm" class="macro">gettotalbytes</a>(<a href="../h_src/57949940.htm" class="localvar">g</a>) / 100)) * <a href="../h_src/57949940.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645820.htm" class="variable">genminormul</a>));
  1317 :    <a href="../h_src/57638612.htm" class="function">luaE_setdebt</a>(<a href="../h_src/57949940.htm" class="localvar">g</a>, -(<a href="../h_src/57547760.htm" class="macro">cast</a>(<a href="../h_src/57550548.htm" class="type">l_mem</a>, (<a href="../h_src/57638748.htm" class="macro">gettotalbytes</a>(<a href="../h_src/57949940.htm" class="localvar">g</a>) / 100)) * <a href="../h_src/57949940.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645820.htm" class="variable">genminormul</a>));
  1412 :    <a href="../h_src/57947900.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646500.htm" class="variable">GCestimate</a> = <a href="../h_src/57638748.htm" class="macro">gettotalbytes</a>(<a href="../h_src/57947900.htm" class="localvar">g</a>);  <a  class="comments">/* first estimate */</a>;
  1446 :    if (<a href="../h_src/57947220.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646568.htm" class="variable">GCdebt</a> &gt; 0 &amp;&amp; <a href="../h_src/57638748.htm" class="macro">gettotalbytes</a>(<a href="../h_src/57947220.htm" class="localvar">g</a>) &gt; <a href="../h_src/57947084.htm" class="localvar">majorbase</a> + <a href="../h_src/57946948.htm" class="localvar">majorinc</a>) {
  1448 :    if (<a href="../h_src/57638748.htm" class="macro">gettotalbytes</a>(<a href="../h_src/57947220.htm" class="localvar">g</a>) &lt; <a href="../h_src/57947084.htm" class="localvar">majorbase</a> + (<a href="../h_src/57946948.htm" class="localvar">majorinc</a> / 2)) {
  1516 :    <a href="../h_src/57946404.htm" class="function">deletelist</a>(<a href="../h_src/57945724.htm" class="localvar">L</a>, <a href="../h_src/57945588.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645344.htm" class="variable">allgc</a>, <a href="../h_src/57638884.htm" class="macro">obj2gco</a>(<a href="../h_src/57945588.htm" class="localvar">g</a>-&gt;<a href="../h_src/57643848.htm" class="variable">mainthread</a>));
  1532 :    <a href="../h_src/57827024.htm" class="macro">markobject</a>(<a href="../h_src/57945316.htm" class="localvar">g</a>, <a href="../h_src/57945452.htm" class="localvar">L</a>);  <a  class="comments">/* mark running thread */</a>
  1576 :    <a href="../h_src/57944364.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646024.htm" class="variable">gcstate</a> = <a href="../h_src/57944228.htm" class="localvar">nextstate</a>;
  1607 :    <a href="../h_src/57943412.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646500.htm" class="variable">GCestimate</a> = <a href="../h_src/57638748.htm" class="macro">gettotalbytes</a>(<a href="../h_src/57943412.htm" class="localvar">g</a>);  <a  class="comments">/* first estimate */</a>;
  1611 :    <a href="../h_src/57943276.htm" class="localvar">work</a> = <a href="../h_src/57944636.htm" class="function">sweepstep</a>(<a href="../h_src/57943548.htm" class="localvar">L</a>, <a href="../h_src/57943412.htm" class="localvar">g</a>, <a href="../h_src/57629228.htm" class="macro">GCSswpfinobj</a>, &amp;<a href="../h_src/57943412.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645140.htm" class="variable">finobj</a>);
  1615 :    <a href="../h_src/57943276.htm" class="localvar">work</a> = <a href="../h_src/57944636.htm" class="function">sweepstep</a>(<a href="../h_src/57943548.htm" class="localvar">L</a>, <a href="../h_src/57943412.htm" class="localvar">g</a>, <a href="../h_src/57629092.htm" class="macro">GCSswptobefnz</a>, &amp;<a href="../h_src/57943412.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644732.htm" class="variable">tobefnz</a>);
  1619 :    <a href="../h_src/57943276.htm" class="localvar">work</a> = <a href="../h_src/57944636.htm" class="function">sweepstep</a>(<a href="../h_src/57943548.htm" class="localvar">L</a>, <a href="../h_src/57943412.htm" class="localvar">g</a>, <a href="../h_src/57628956.htm" class="macro">GCSswpend</a>, NULL);
  1631 :    <a href="../h_src/57943276.htm" class="localvar">work</a> = <a href="../h_src/57960412.htm" class="function">runafewfinalizers</a>(<a href="../h_src/57943548.htm" class="localvar">L</a>, <a href="../h_src/57828928.htm" class="macro">GCFINMAX</a>) * <a href="../h_src/57828792.htm" class="macro">GCFINALIZECOST</a>;
  1670 :    : <a href="../h_src/57549936.htm" class="macro">MAX_LMEM</a>;  <a  class="comments">/* overflow; keep maximum value */</a>
  1729 :    <a href="../h_src/57940828.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645616.htm" class="variable">gcemergency</a> = <a href="../h_src/57940964.htm" class="localvar">isemergency</a>;  <a  class="comments">/* set flag */</a>
</pre>
<pre>
</pre>
<h5>Needs Compound Statement</h5>
<pre>
   173 :    if (<a href="../h_src/57503152.htm" class="macro">keyiscollectable</a>(<a href="../h_src/57824848.htm" class="localvar">n</a>))
   174 :    <a href="../h_src/57502744.htm" class="macro">setdeadkey</a>(<a href="../h_src/57824848.htm" class="localvar">n</a>);  <a  class="comments">/* unused key; remove it */</a>
   186 :    if (<a href="../h_src/57824440.htm" class="localvar">o</a> == NULL) return 0;  <a  class="comments">/* non-collectable value */</a>
   188 :    <a href="../h_src/57827024.htm" class="macro">markobject</a>(<a href="../h_src/57824576.htm" class="localvar">g</a>, <a href="../h_src/57824440.htm" class="localvar">o</a>);  <a  class="comments">/* strings are 'values', so are never weak */</a>
   191 :    else return <a href="../h_src/57626372.htm" class="macro">iswhite</a>(<a href="../h_src/57824440.htm" class="localvar">o</a>);
   220 :    if (<a href="../h_src/57823896.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645956.htm" class="variable">gckind</a> == <a href="../h_src/57652280.htm" class="macro">KGC_INC</a>)  <a  class="comments">/* incremental mode? */</a>
   221 :    <a href="../h_src/57828112.htm" class="macro">makewhite</a>(<a href="../h_src/57823896.htm" class="localvar">g</a>, <a href="../h_src/57824168.htm" class="localvar">o</a>);  <a  class="comments">/* mark 'o' as white to avoid other barriers */</a>
   234 :    if (<a href="../h_src/57623924.htm" class="macro">getage</a>(<a href="../h_src/57823624.htm" class="localvar">o</a>) == <a href="../h_src/57624196.htm" class="macro">G_TOUCHED2</a>)  <a  class="comments">/* already in gray list? */</a>
   235 :    <a href="../h_src/57827976.htm" class="macro">set2gray</a>(<a href="../h_src/57823624.htm" class="localvar">o</a>);  <a  class="comments">/* make it gray to become touched1 */</a>
   236 :    else  <a  class="comments">/* link it in 'grayagain' and paint it gray */</a>
   237 :    <a href="../h_src/57825120.htm" class="macro">linkobjgclist</a>(<a href="../h_src/57823624.htm" class="localvar">o</a>, <a href="../h_src/57823488.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);
   238 :    if (<a href="../h_src/57623652.htm" class="macro">isold</a>(<a href="../h_src/57823624.htm" class="localvar">o</a>))  <a  class="comments">/* generational mode? */</a>
   239 :    <a href="../h_src/57623788.htm" class="macro">setage</a>(<a href="../h_src/57823624.htm" class="localvar">o</a>, <a href="../h_src/57624332.htm" class="macro">G_TOUCHED1</a>);  <a  class="comments">/* touched in current cycle */</a>
   306 :    if (<a href="../h_src/57631540.htm" class="macro">upisopen</a>(<a href="../h_src/57821312.htm" class="localvar">uv</a>))
   307 :    <a href="../h_src/57827976.htm" class="macro">set2gray</a>(<a href="../h_src/57821312.htm" class="localvar">uv</a>);  <a  class="comments">/* open upvalues are kept gray */</a>
   308 :    else
   309 :    <a href="../h_src/57827840.htm" class="macro">set2black</a>(<a href="../h_src/57821312.htm" class="localvar">uv</a>);  <a  class="comments">/* closed upvalues are visited here */</a>
   310 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57821584.htm" class="localvar">g</a>, <a href="../h_src/57821312.htm" class="localvar">uv</a>-&gt;<a href="../h_src/57510564.htm" class="variable">v</a>.<a href="../h_src/57510768.htm" class="variable">p</a>);  <a  class="comments">/* mark its content */</a>
   316 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57821584.htm" class="localvar">g</a>, <a href="../h_src/57821176.htm" class="localvar">u</a>-&gt;<a href="../h_src/57519540.htm" class="variable">metatable</a>);  <a  class="comments">/* mark its metatable */</a>
   338 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57820904.htm" class="localvar">g</a>, <a href="../h_src/57820904.htm" class="localvar">g</a>-&gt;<a href="../h_src/57643440.htm" class="variable">mt</a>[<a href="../h_src/57820768.htm" class="localvar">i</a>]);
   350 :    <a href="../h_src/57827024.htm" class="macro">markobject</a>(<a href="../h_src/57820496.htm" class="localvar">g</a>, <a href="../h_src/57820360.htm" class="localvar">o</a>);
   373 :    if (!<a href="../h_src/57626372.htm" class="macro">iswhite</a>(<a href="../h_src/57819816.htm" class="localvar">thread</a>) &amp;&amp; <a href="../h_src/57819816.htm" class="localvar">thread</a>-&gt;<a href="../h_src/57642216.htm" class="variable">openupval</a> != NULL)
   374 :    <a href="../h_src/57819612.htm" class="localvar">p</a> = &amp;<a href="../h_src/57819816.htm" class="localvar">thread</a>-&gt;<a href="../h_src/57642012.htm" class="variable">twups</a>;  <a  class="comments">/* keep marked thread with upvalues in the list */</a>
   385 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57819952.htm" class="localvar">g</a>, <a href="../h_src/57819340.htm" class="localvar">uv</a>-&gt;<a href="../h_src/57510564.htm" class="variable">v</a>.<a href="../h_src/57510768.htm" class="variable">p</a>);  <a  class="comments">/* mark its value */</a>
   405 :    <a href="../h_src/57827024.htm" class="macro">markobject</a>(<a href="../h_src/57818796.htm" class="localvar">g</a>, <a href="../h_src/57818796.htm" class="localvar">g</a>-&gt;<a href="../h_src/57643848.htm" class="variable">mainthread</a>);
   406 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57818796.htm" class="localvar">g</a>, &amp;<a href="../h_src/57818796.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646296.htm" class="variable">l_registry</a>);
   435 :    else if (<a href="../h_src/57623924.htm" class="macro">getage</a>(<a href="../h_src/57818388.htm" class="localvar">o</a>) == <a href="../h_src/57624196.htm" class="macro">G_TOUCHED2</a>)
   436 :    <a href="../h_src/57623516.htm" class="macro">changeage</a>(<a href="../h_src/57818388.htm" class="localvar">o</a>, <a href="../h_src/57624196.htm" class="macro">G_TOUCHED2</a>, <a href="../h_src/57624468.htm" class="macro">G_OLD</a>);  <a  class="comments">/* advance age */</a>
   452 :    if (<a href="../h_src/57530488.htm" class="macro">isempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57817844.htm" class="localvar">n</a>)))  <a  class="comments">/* entry is empty? */</a>
   453 :    <a href="../h_src/57824984.htm" class="function">clearkey</a>(<a href="../h_src/57817844.htm" class="localvar">n</a>);  <a  class="comments">/* clear its key */</a>
   456 :    <a href="../h_src/57827160.htm" class="macro">markkey</a>(<a href="../h_src/57818116.htm" class="localvar">g</a>, <a href="../h_src/57817844.htm" class="localvar">n</a>);
   457 :    if (!<a href="../h_src/57817572.htm" class="localvar">hasclears</a> &amp;&amp; <a href="../h_src/57824712.htm" class="function">iscleared</a>(<a href="../h_src/57818116.htm" class="localvar">g</a>, <a href="../h_src/57827432.htm" class="macro">gcvalueN</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57817844.htm" class="localvar">n</a>))))  <a  class="comments">/* a white value? */</a>
   458 :    <a href="../h_src/57817572.htm" class="localvar">hasclears</a> = 1;  <a  class="comments">/* table will have to be cleared */</a>
   461 :    if (<a href="../h_src/57818116.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646024.htm" class="variable">gcstate</a> == <a href="../h_src/57629500.htm" class="macro">GCSatomic</a> &amp;&amp; <a href="../h_src/57817572.htm" class="localvar">hasclears</a>)
   462 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57817980.htm" class="localvar">h</a>, <a href="../h_src/57818116.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644936.htm" class="variable">weak</a>);  <a  class="comments">/* has to be cleared later */</a>
   463 :    else
   464 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57817980.htm" class="localvar">h</a>, <a href="../h_src/57818116.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);  <a  class="comments">/* must retraverse it in atomic phase */</a>
   498 :    if (<a href="../h_src/57530488.htm" class="macro">isempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57976052.htm" class="localvar">n</a>)))  <a  class="comments">/* entry is empty? */</a>
   499 :    <a href="../h_src/57824984.htm" class="function">clearkey</a>(<a href="../h_src/57976052.htm" class="localvar">n</a>);  <a  class="comments">/* clear its key */</a>
   502 :    if (<a href="../h_src/57827704.htm" class="macro">valiswhite</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57976052.htm" class="localvar">n</a>)))  <a  class="comments">/* value not marked yet? */</a><a href="../h_src/57528040.htm" class="variable">marked</a> yet? */
   503 :    <a href="../h_src/57976596.htm" class="localvar">hasww</a> = 1;  <a  class="comments">/* white-white entry */</a>
   511 :    if (<a href="../h_src/57977276.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646024.htm" class="variable">gcstate</a> == <a href="../h_src/57629772.htm" class="macro">GCSpropagate</a>)
   512 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57977140.htm" class="localvar">h</a>, <a href="../h_src/57977276.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);  <a  class="comments">/* must retraverse it in atomic phase */</a>
   513 :    else if (<a href="../h_src/57976596.htm" class="localvar">hasww</a>)  <a  class="comments">/* table has white-&gt;white entries? */</a>
   514 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57977140.htm" class="localvar">h</a>, <a href="../h_src/57977276.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644868.htm" class="variable">ephemeron</a>);  <a  class="comments">/* have to propagate again */</a>
   515 :    else if (<a href="../h_src/57976732.htm" class="localvar">hasclears</a>)  <a  class="comments">/* table has white keys? */</a>
   516 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57977140.htm" class="localvar">h</a>, <a href="../h_src/57977276.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644800.htm" class="variable">allweak</a>);  <a  class="comments">/* may have to clean white keys */</a>
   517 :    else
   518 :    <a href="../h_src/57818660.htm" class="function">genlink</a>(<a href="../h_src/57977276.htm" class="localvar">g</a>, <a href="../h_src/57638884.htm" class="macro">obj2gco</a>(<a href="../h_src/57977140.htm" class="localvar">h</a>));  <a  class="comments">/* check whether collector still needs to see it */</a>
   528 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57975780.htm" class="localvar">g</a>, &amp;<a href="../h_src/57975644.htm" class="localvar">h</a>-&gt;<a href="../h_src/57504716.htm" class="variable">array</a>[<a href="../h_src/57975236.htm" class="localvar">i</a>]);
   530 :    if (<a href="../h_src/57530488.htm" class="macro">isempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57975508.htm" class="localvar">n</a>)))  <a  class="comments">/* entry is empty? */</a>
   531 :    <a href="../h_src/57824984.htm" class="function">clearkey</a>(<a href="../h_src/57975508.htm" class="localvar">n</a>);  <a  class="comments">/* clear its key */</a>
   534 :    <a href="../h_src/57827160.htm" class="macro">markkey</a>(<a href="../h_src/57975780.htm" class="localvar">g</a>, <a href="../h_src/57975508.htm" class="localvar">n</a>);
   535 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57975780.htm" class="localvar">g</a>, <a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57975508.htm" class="localvar">n</a>));
   545 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57974828.htm" class="localvar">g</a>, <a href="../h_src/57974692.htm" class="localvar">h</a>-&gt;<a href="../h_src/57504444.htm" class="variable">metatable</a>);
   550 :    if (!<a href="../h_src/57974556.htm" class="localvar">weakkey</a>)  <a  class="comments">/* strong keys? */</a>
   551 :    <a href="../h_src/57818252.htm" class="function">traverseweakvalue</a>(<a href="../h_src/57974828.htm" class="localvar">g</a>, <a href="../h_src/57974692.htm" class="localvar">h</a>);
   552 :    else if (!<a href="../h_src/57974420.htm" class="localvar">weakvalue</a>)  <a  class="comments">/* strong values? */</a>
   553 :    <a href="../h_src/57817436.htm" class="function">traverseephemeron</a>(<a href="../h_src/57974828.htm" class="localvar">g</a>, <a href="../h_src/57974692.htm" class="localvar">h</a>, 0);
   554 :    else  <a  class="comments">/* all weak */</a>
   555 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57974692.htm" class="localvar">h</a>, <a href="../h_src/57974828.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644800.htm" class="variable">allweak</a>);  <a  class="comments">/* nothing to traverse now */</a>
   557 :    else  <a  class="comments">/* not weak */</a>
   558 :    <a href="../h_src/57975916.htm" class="function">traversestrongtable</a>(<a href="../h_src/57974828.htm" class="localvar">g</a>, <a href="../h_src/57974692.htm" class="localvar">h</a>);
   565 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57974012.htm" class="localvar">g</a>, <a href="../h_src/57973876.htm" class="localvar">u</a>-&gt;<a href="../h_src/57519540.htm" class="variable">metatable</a>);  <a  class="comments">/* mark its metatable */</a>
   567 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57974012.htm" class="localvar">g</a>, &amp;<a href="../h_src/57973876.htm" class="localvar">u</a>-&gt;<a href="../h_src/57519336.htm" class="variable">uv</a>[<a href="../h_src/57973740.htm" class="localvar">i</a>].<a href="../h_src/57520764.htm" class="variable">uv</a>);
   580 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57973468.htm" class="localvar">g</a>, <a href="../h_src/57973332.htm" class="localvar">f</a>-&gt;<a href="../h_src/57513964.htm" class="variable">source</a>);
   582 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57973468.htm" class="localvar">g</a>, &amp;<a href="../h_src/57973332.htm" class="localvar">f</a>-&gt;<a href="../h_src/57515052.htm" class="variable">k</a>[<a href="../h_src/57973196.htm" class="localvar">i</a>]);
   584 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57973468.htm" class="localvar">g</a>, <a href="../h_src/57973332.htm" class="localvar">f</a>-&gt;<a href="../h_src/57514440.htm" class="variable">upvalues</a>[<a href="../h_src/57973196.htm" class="localvar">i</a>].<a href="../h_src/57517364.htm" class="variable">name</a>);
   586 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57973468.htm" class="localvar">g</a>, <a href="../h_src/57973332.htm" class="localvar">f</a>-&gt;<a href="../h_src/57514576.htm" class="variable">p</a>[<a href="../h_src/57973196.htm" class="localvar">i</a>]);
   588 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57973468.htm" class="localvar">g</a>, <a href="../h_src/57973332.htm" class="localvar">f</a>-&gt;<a href="../h_src/57514032.htm" class="variable">locvars</a>[<a href="../h_src/57973196.htm" class="localvar">i</a>].<a href="../h_src/57516888.htm" class="variable">varname</a>);
   596 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57972924.htm" class="localvar">g</a>, &amp;<a href="../h_src/57972788.htm" class="localvar">cl</a>-&gt;<a href="../h_src/57508796.htm" class="variable">upvalue</a>[<a href="../h_src/57972652.htm" class="localvar">i</a>]);
   606 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57972380.htm" class="localvar">g</a>, <a href="../h_src/57972244.htm" class="localvar">cl</a>-&gt;<a href="../h_src/57508184.htm" class="variable">p</a>);  <a  class="comments">/* mark its prototype */</a>
   609 :    <a href="../h_src/57826888.htm" class="macro">markobjectN</a>(<a href="../h_src/57972380.htm" class="localvar">g</a>, <a href="../h_src/57971972.htm" class="localvar">uv</a>);  <a  class="comments">/* mark upvalue */</a>
   630 :    if (<a href="../h_src/57623652.htm" class="macro">isold</a>(<a href="../h_src/57971564.htm" class="localvar">th</a>) || <a href="../h_src/57971700.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646024.htm" class="variable">gcstate</a> == <a href="../h_src/57629772.htm" class="macro">GCSpropagate</a>)
   631 :    <a href="../h_src/57825800.htm" class="macro">linkgclist</a>(<a href="../h_src/57971564.htm" class="localvar">th</a>, <a href="../h_src/57971700.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645004.htm" class="variable">grayagain</a>);  <a  class="comments">/* insert into 'grayagain' list */</a>
   632 :    if (<a href="../h_src/57971292.htm" class="localvar">o</a> == NULL)
   633 :    return 1;  <a  class="comments">/* stack not completely built yet */</a>
   637 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57971700.htm" class="localvar">g</a>, <a href="../h_src/57531712.htm" class="macro">s2v</a>(<a href="../h_src/57971292.htm" class="localvar">o</a>));
   639 :    <a href="../h_src/57827024.htm" class="macro">markobject</a>(<a href="../h_src/57971700.htm" class="localvar">g</a>, <a href="../h_src/57971428.htm" class="localvar">uv</a>);  <a  class="comments">/* open upvalues cannot be collected */</a>
   641 :    for (; <a href="../h_src/57971292.htm" class="localvar">o</a> &lt; <a href="../h_src/57971564.htm" class="localvar">th</a>-&gt;<a href="../h_src/57642352.htm" class="variable">stack_last</a>.<a href="../h_src/57531984.htm" class="variable">p</a> + <a href="../h_src/57652688.htm" class="macro">EXTRA_STACK</a>; <a href="../h_src/57971292.htm" class="localvar">o</a>++)
   642 :    <a href="../h_src/57530896.htm" class="macro">setnilvalue</a>(<a href="../h_src/57531712.htm" class="macro">s2v</a>(<a href="../h_src/57971292.htm" class="localvar">o</a>));  <a  class="comments">/* clear dead stack slice */</a>
   649 :    else if (!<a href="../h_src/57971700.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645616.htm" class="variable">gcemergency</a>)
   650 :    <a href="../h_src/57632696.htm" class="function">luaD_shrinkstack</a>(<a href="../h_src/57971564.htm" class="localvar">th</a>); <a  class="comments">/* do not change stack in emergency cycle */</a>
   676 :    while (<a href="../h_src/57970612.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645072.htm" class="variable">gray</a>)
   677 :    <a href="../h_src/57970476.htm" class="localvar">tot</a> += <a href="../h_src/57971156.htm" class="function">propagatemark</a>(<a href="../h_src/57970612.htm" class="localvar">g</a>);
   729 :    if (<a href="../h_src/57824712.htm" class="function">iscleared</a>(<a href="../h_src/57969252.htm" class="localvar">g</a>, <a href="../h_src/57502880.htm" class="macro">gckeyN</a>(<a href="../h_src/57968708.htm" class="localvar">n</a>)))  <a  class="comments">/* unmarked key? */</a>
   730 :    <a href="../h_src/57530216.htm" class="macro">setempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57968708.htm" class="localvar">n</a>));  <a  class="comments">/* remove entry */</a>
   731 :    if (<a href="../h_src/57530488.htm" class="macro">isempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57968708.htm" class="localvar">n</a>)))  <a  class="comments">/* is entry empty? */</a>
   732 :    <a href="../h_src/57824984.htm" class="function">clearkey</a>(<a href="../h_src/57968708.htm" class="localvar">n</a>);  <a  class="comments">/* clear its key */</a>
   750 :    if (<a href="../h_src/57824712.htm" class="function">iscleared</a>(<a href="../h_src/57968436.htm" class="localvar">g</a>, <a href="../h_src/57827432.htm" class="macro">gcvalueN</a>(<a href="../h_src/57967348.htm" class="localvar">o</a>)))  <a  class="comments">/* value was collected? */</a>
   751 :    <a href="../h_src/57530216.htm" class="macro">setempty</a>(<a href="../h_src/57967348.htm" class="localvar">o</a>);  <a  class="comments">/* remove entry */</a>
   754 :    if (<a href="../h_src/57824712.htm" class="function">iscleared</a>(<a href="../h_src/57968436.htm" class="localvar">g</a>, <a href="../h_src/57827432.htm" class="macro">gcvalueN</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57967892.htm" class="localvar">n</a>))))  <a  class="comments">/* unmarked value? */</a>
   755 :    <a href="../h_src/57530216.htm" class="macro">setempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57967892.htm" class="localvar">n</a>));  <a  class="comments">/* remove entry */</a>
   756 :    if (<a href="../h_src/57530488.htm" class="macro">isempty</a>(<a href="../h_src/57617872.htm" class="macro">gval</a>(<a href="../h_src/57967892.htm" class="localvar">n</a>)))  <a  class="comments">/* is entry empty? */</a>
   757 :    <a href="../h_src/57824984.htm" class="function">clearkey</a>(<a href="../h_src/57967892.htm" class="localvar">n</a>);  <a  class="comments">/* clear its key */</a>
   764 :    if (<a href="../h_src/57631540.htm" class="macro">upisopen</a>(<a href="../h_src/57966940.htm" class="localvar">uv</a>))
   765 :    <a href="../h_src/57630316.htm" class="function">luaF_unlinkupval</a>(<a href="../h_src/57966940.htm" class="localvar">uv</a>);
   840 :    if (<a href="../h_src/57965172.htm" class="localvar">countout</a>)
   841 :    *<a href="../h_src/57965172.htm" class="localvar">countout</a> = <a href="../h_src/57964764.htm" class="localvar">i</a>;  <a  class="comments">/* number of elements traversed */</a>
   891 :    if (<a href="../h_src/57628548.htm" class="macro">issweepphase</a>(<a href="../h_src/57962996.htm" class="localvar">g</a>))
   892 :    <a href="../h_src/57828112.htm" class="macro">makewhite</a>(<a href="../h_src/57962996.htm" class="localvar">g</a>, <a href="../h_src/57962860.htm" class="localvar">o</a>);  <a  class="comments">/* &quot;sweep&quot; object */</a>
   893 :    else if (<a href="../h_src/57623924.htm" class="macro">getage</a>(<a href="../h_src/57962860.htm" class="localvar">o</a>) == <a href="../h_src/57624604.htm" class="macro">G_OLD1</a>)
   894 :    <a href="../h_src/57962996.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644392.htm" class="variable">firstold1</a> = <a href="../h_src/57962860.htm" class="localvar">o</a>;  <a  class="comments">/* it is the first OLD1 object in the list */</a>
   939 :    for (<a href="../h_src/57959868.htm" class="localvar">i</a> = 0; <a href="../h_src/57959868.htm" class="localvar">i</a> &lt; <a href="../h_src/57960140.htm" class="localvar">n</a> &amp;&amp; <a href="../h_src/57960004.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644732.htm" class="variable">tobefnz</a>; <a href="../h_src/57959868.htm" class="localvar">i</a>++)
   940 :    <a href="../h_src/57962316.htm" class="function">GCTM</a>(<a href="../h_src/57960276.htm" class="localvar">L</a>);  <a  class="comments">/* call one finalizer */</a>
   950 :    while (<a href="../h_src/57959460.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644732.htm" class="variable">tobefnz</a>)
   951 :    <a href="../h_src/57962316.htm" class="function">GCTM</a>(<a href="../h_src/57959596.htm" class="localvar">L</a>);
   959 :    while (*<a href="../h_src/57959188.htm" class="localvar">p</a> != NULL)
   960 :    <a href="../h_src/57959188.htm" class="localvar">p</a> = &amp;(*<a href="../h_src/57959188.htm" class="localvar">p</a>)-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>;
   978 :    if (!(<a href="../h_src/57626372.htm" class="macro">iswhite</a>(<a href="../h_src/57958644.htm" class="localvar">curr</a>) || <a href="../h_src/57958780.htm" class="localvar">all</a>))  <a  class="comments">/* not being collected? */</a>
   979 :    <a href="../h_src/57958508.htm" class="localvar">p</a> = &amp;<a href="../h_src/57958644.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>;  <a  class="comments">/* don't bother with it */</a>
   981 :    if (<a href="../h_src/57958644.htm" class="localvar">curr</a> == <a href="../h_src/57958916.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644324.htm" class="variable">finobjsur</a>)  <a  class="comments">/* removing 'finobjsur'? */</a>
   982 :    <a href="../h_src/57958916.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644324.htm" class="variable">finobjsur</a> = <a href="../h_src/57958644.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>;  <a  class="comments">/* correct it */</a>
   996 :    if (<a href="../h_src/57957964.htm" class="localvar">o</a> == *<a href="../h_src/57958100.htm" class="localvar">p</a>)
   997 :    *<a href="../h_src/57958100.htm" class="localvar">p</a> = <a href="../h_src/57957964.htm" class="localvar">o</a>-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>;
  1021 :    (<a href="../h_src/57957012.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645684.htm" class="variable">gcstp</a> &amp; <a href="../h_src/57622020.htm" class="macro">GCSTPCLS</a>))                   <a  class="comments">/* or closing state? */</a>
  1022 :    return;  <a  class="comments">/* nothing to be done */</a>
  1027 :    if (<a href="../h_src/57957012.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645208.htm" class="variable">sweepgc</a> == &amp;<a href="../h_src/57957284.htm" class="localvar">o</a>-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>)  <a  class="comments">/* should not remove 'sweepgc' object */</a>
  1028 :    <a href="../h_src/57957012.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645208.htm" class="variable">sweepgc</a> = <a href="../h_src/57964220.htm" class="function">sweeptolive</a>(<a href="../h_src/57957420.htm" class="localvar">L</a>, <a href="../h_src/57957012.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645208.htm" class="variable">sweepgc</a>);  <a  class="comments">/* change 'sweepgc' */</a>
  1030 :    else
  1031 :    <a href="../h_src/57957828.htm" class="function">correctpointers</a>(<a href="../h_src/57957012.htm" class="localvar">g</a>, <a href="../h_src/57957284.htm" class="localvar">o</a>);
  1066 :    if (<a href="../h_src/57956332.htm" class="localvar">debt</a> &gt; 0) <a href="../h_src/57956332.htm" class="localvar">debt</a> = 0;
  1092 :    else if (<a href="../h_src/57955516.htm" class="localvar">curr</a>-&gt;<a href="../h_src/57528108.htm" class="variable">tt</a> == <a href="../h_src/57513760.htm" class="macro">LUA_VUPVAL</a> &amp;&amp; <a href="../h_src/57631540.htm" class="macro">upisopen</a>(<a href="../h_src/57639020.htm" class="macro">gco2upv</a>(<a href="../h_src/57955516.htm" class="localvar">curr</a>)))
  1093 :    <a href="../h_src/57827976.htm" class="macro">set2gray</a>(<a href="../h_src/57955516.htm" class="localvar">curr</a>);  <a  class="comments">/* open upvalues are always gray */</a>
  1094 :    else  <a  class="comments">/* everything else is black */</a>
  1095 :    <a href="../h_src/57625284.htm" class="macro">nw2black</a>(<a href="../h_src/57955516.htm" class="localvar">curr</a>);
  1139 :    if (<a href="../h_src/57623924.htm" class="macro">getage</a>(<a href="../h_src/57954020.htm" class="localvar">curr</a>) == <a href="../h_src/57624604.htm" class="macro">G_OLD1</a> &amp;&amp; *<a href="../h_src/57954428.htm" class="localvar">pfirstold1</a> == NULL)
  1140 :    *<a href="../h_src/57954428.htm" class="localvar">pfirstold1</a> = <a href="../h_src/57954020.htm" class="localvar">curr</a>;  <a  class="comments">/* first OLD1 object in the list */</a>
  1156 :    for (; <a href="../h_src/57953476.htm" class="localvar">p</a> != NULL; <a href="../h_src/57953476.htm" class="localvar">p</a> = <a href="../h_src/57953476.htm" class="localvar">p</a>-&gt;<a href="../h_src/57528176.htm" class="variable">next</a>)
  1157 :    <a href="../h_src/57953476.htm" class="localvar">p</a>-&gt;<a href="../h_src/57528040.htm" class="variable">marked</a> = <a href="../h_src/57546944.htm" class="macro">cast_byte</a>((<a href="../h_src/57953476.htm" class="localvar">p</a>-&gt;<a href="../h_src/57528040.htm" class="variable">marked</a> &amp; ~<a href="../h_src/57828248.htm" class="macro">maskgcbits</a>) | <a href="../h_src/57953340.htm" class="localvar">white</a>);
  1174 :    if (<a href="../h_src/57626372.htm" class="macro">iswhite</a>(<a href="../h_src/57952932.htm" class="localvar">curr</a>))
  1175 :    goto remove;  <a  class="comments">/* remove all white objects */</a>
  1188 :    if (<a href="../h_src/57623924.htm" class="macro">getage</a>(<a href="../h_src/57952932.htm" class="localvar">curr</a>) == <a href="../h_src/57624196.htm" class="macro">G_TOUCHED2</a>)  <a  class="comments">/* advance from TOUCHED2... */</a>
  1189 :    <a href="../h_src/57623516.htm" class="macro">changeage</a>(<a href="../h_src/57952932.htm" class="localvar">curr</a>, <a href="../h_src/57624196.htm" class="macro">G_TOUCHED2</a>, <a href="../h_src/57624468.htm" class="macro">G_OLD</a>);  <a  class="comments">/* ... to OLD */</a>
  1225 :    if (<a href="../h_src/57626236.htm" class="macro">isblack</a>(<a href="../h_src/57951708.htm" class="localvar">p</a>))
  1226 :    <a href="../h_src/57826752.htm" class="function">reallymarkobject</a>(<a href="../h_src/57952116.htm" class="localvar">g</a>, <a href="../h_src/57951708.htm" class="localvar">p</a>);
  1239 :    if (!<a href="../h_src/57951300.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645616.htm" class="variable">gcemergency</a>)
  1240 :    <a href="../h_src/57959732.htm" class="function">callallpendingfinalizers</a>(<a href="../h_src/57951436.htm" class="localvar">L</a>);
  1361 :    if (<a href="../h_src/57948852.htm" class="localvar">newmode</a> == <a href="../h_src/57652144.htm" class="macro">KGC_GEN</a>)  <a  class="comments">/* entering generational mode? */</a>
  1362 :    <a href="../h_src/57949804.htm" class="function">entergen</a>(<a href="../h_src/57948988.htm" class="localvar">L</a>, <a href="../h_src/57948716.htm" class="localvar">g</a>);
  1363 :    else
  1364 :    <a href="../h_src/57949260.htm" class="function">enterinc</a>(<a href="../h_src/57948716.htm" class="localvar">g</a>);  <a  class="comments">/* entering incremental mode */</a>
  1403 :    if (<a href="../h_src/57947900.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645956.htm" class="variable">gckind</a> == <a href="../h_src/57652144.htm" class="macro">KGC_GEN</a>)  <a  class="comments">/* still in generational mode? */</a>
  1404 :    <a href="../h_src/57949260.htm" class="function">enterinc</a>(<a href="../h_src/57947900.htm" class="localvar">g</a>);  <a  class="comments">/* enter incremental mode */</a>
  1441 :    if (<a href="../h_src/57947220.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646432.htm" class="variable">lastatomic</a> != 0)  <a  class="comments">/* last collection was a bad one? */</a>
  1442 :    <a href="../h_src/57948172.htm" class="function">stepgenfull</a>(<a href="../h_src/57947356.htm" class="localvar">L</a>, <a href="../h_src/57947220.htm" class="localvar">g</a>);  <a  class="comments">/* do a full step */</a>
  1532 :    <a href="../h_src/57827024.htm" class="macro">markobject</a>(<a href="../h_src/57945316.htm" class="localvar">g</a>, <a href="../h_src/57945452.htm" class="localvar">L</a>);  <a  class="comments">/* mark running thread */</a>
  1534 :    <a href="../h_src/57827296.htm" class="macro">markvalue</a>(<a href="../h_src/57945316.htm" class="localvar">g</a>, &amp;<a href="../h_src/57945316.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646296.htm" class="variable">l_registry</a>);
  1600 :    else
  1601 :    <a href="../h_src/57943276.htm" class="localvar">work</a> = <a href="../h_src/57971156.htm" class="function">propagatemark</a>(<a href="../h_src/57943412.htm" class="localvar">g</a>);  <a  class="comments">/* traverse one gray object */</a>
  1652 :    while (!<a href="../h_src/57627324.htm" class="macro">testbit</a>(<a href="../h_src/57943004.htm" class="localvar">statesmask</a>, <a href="../h_src/57942868.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646024.htm" class="variable">gcstate</a>))
  1653 :    <a href="../h_src/57943684.htm" class="function">singlestep</a>(<a href="../h_src/57943140.htm" class="localvar">L</a>);
  1675 :    if (<a href="../h_src/57942460.htm" class="localvar">g</a>-&gt;<a href="../h_src/57646024.htm" class="variable">gcstate</a> == <a href="../h_src/57628684.htm" class="macro">GCSpause</a>)
  1676 :    <a href="../h_src/57956740.htm" class="function">setpause</a>(<a href="../h_src/57942460.htm" class="localvar">g</a>);  <a  class="comments">/* pause until next cycle */</a>
  1690 :    if (!<a href="../h_src/57621884.htm" class="macro">gcrunning</a>(<a href="../h_src/57941644.htm" class="localvar">g</a>))  <a  class="comments">/* not running? */</a>
  1691 :    <a href="../h_src/57638612.htm" class="function">luaE_setdebt</a>(<a href="../h_src/57941644.htm" class="localvar">g</a>, -2000);
  1693 :    if(<a href="../h_src/57622428.htm" class="macro">isdecGCmodegen</a>(<a href="../h_src/57941644.htm" class="localvar">g</a>))
  1694 :    <a href="../h_src/57947492.htm" class="function">genstep</a>(<a href="../h_src/57941780.htm" class="localvar">L</a>, <a href="../h_src/57941644.htm" class="localvar">g</a>);
  1695 :    else
  1696 :    <a href="../h_src/57942732.htm" class="function">incstep</a>(<a href="../h_src/57941780.htm" class="localvar">L</a>, <a href="../h_src/57941644.htm" class="localvar">g</a>);
  1709 :    if (<a href="../h_src/57628412.htm" class="macro">keepinvariant</a>(<a href="../h_src/57941236.htm" class="localvar">g</a>))  <a  class="comments">/* black objects? */</a>
  1710 :    <a href="../h_src/57826480.htm" class="function">entersweep</a>(<a href="../h_src/57941372.htm" class="localvar">L</a>); <a  class="comments">/* sweep everything to turn them back to white */</a>
  1730 :    if (<a href="../h_src/57940828.htm" class="localvar">g</a>-&gt;<a href="../h_src/57645956.htm" class="variable">gckind</a> == <a href="../h_src/57652280.htm" class="macro">KGC_INC</a>)
  1731 :    <a href="../h_src/57941508.htm" class="function">fullinc</a>(<a href="../h_src/57941100.htm" class="localvar">L</a>, <a href="../h_src/57940828.htm" class="localvar">g</a>);
  1732 :    else
  1733 :    <a href="../h_src/57948580.htm" class="function">fullgen</a>(<a href="../h_src/57941100.htm" class="localvar">L</a>, <a href="../h_src/57940828.htm" class="localvar">g</a>);
</pre>
<pre>
</pre>
<h5>Unterminated Case</h5>
<pre>
   315 :    if (<a href="../h_src/57821176.htm" class="localvar">u</a>-&gt;<a href="../h_src/57519948.htm" class="variable">nuvalue</a> == 0) {  <a  class="comments">/* no user values? */</a>
   810 :    default: <a href="../h_src/57548848.htm" class="macro">lua_assert</a>(0);
</pre>
<pre>
</pre>
<h5>Jump Statement</h5>
<pre>
  1175 :    goto remove;  <a  class="comments">/* remove all white objects */</a>
  1180 :    goto remain;  <a  class="comments">/* keep it in the list and go to next element */</a>
  1184 :    goto remain;  <a  class="comments">/* keep non-white threads on the list */</a>
  1191 :    goto remove;
  1193 :    remove: *<a href="../h_src/57953068.htm" class="localvar">p</a> = *<a href="../h_src/57952796.htm" class="localvar">next</a>; continue;
  1194 :    remain: <a href="../h_src/57953068.htm" class="localvar">p</a> = <a href="../h_src/57952796.htm" class="localvar">next</a>; continue;
</pre>
<pre>
</pre>
<h5>Return Ignored</h5>
<pre>
   408 :    <a href="../h_src/57820632.htm" class="function">markbeingfnz</a>(<a href="../h_src/57818796.htm" class="localvar">g</a>);  <a  class="comments">/* mark any finalizing object left from previous cycle */</a>
   553 :    <a href="../h_src/57817436.htm" class="function">traverseephemeron</a>(<a href="../h_src/57974828.htm" class="localvar">g</a>, <a href="../h_src/57974692.htm" class="localvar">h</a>, 0);
   702 :    <a href="../h_src/57970748.htm" class="function">propagateall</a>(<a href="../h_src/57970204.htm" class="localvar">g</a>);  <a  class="comments">/* propagate changes */</a>
  1210 :    <a href="../h_src/57953204.htm" class="function">correctgraylist</a>(<a href="../h_src/57952388.htm" class="localvar">list</a>);
  1259 :    <a href="../h_src/57826616.htm" class="function">atomic</a>(<a href="../h_src/57951028.htm" class="localvar">L</a>);
  1265 :    <a href="../h_src/57955108.htm" class="function">sweepgen</a>(<a href="../h_src/57951028.htm" class="localvar">L</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>, <a href="../h_src/57950756.htm" class="localvar">psurvival</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644528.htm" class="variable">old1</a>, &amp;<a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644392.htm" class="variable">firstold1</a>);
  1274 :    <a href="../h_src/57955108.htm" class="function">sweepgen</a>(<a href="../h_src/57951028.htm" class="localvar">L</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>, <a href="../h_src/57950756.htm" class="localvar">psurvival</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644256.htm" class="variable">finobjold1</a>, &amp;<a href="../h_src/57950620.htm" class="localvar">dummy</a>);
  1279 :    <a href="../h_src/57955108.htm" class="function">sweepgen</a>(<a href="../h_src/57951028.htm" class="localvar">L</a>, <a href="../h_src/57950892.htm" class="localvar">g</a>, &amp;<a href="../h_src/57950892.htm" class="localvar">g</a>-&gt;<a href="../h_src/57644732.htm" class="variable">tobefnz</a>, NULL, &amp;<a href="../h_src/57950620.htm" class="localvar">dummy</a>);
  1362 :    <a href="../h_src/57949804.htm" class="function">entergen</a>(<a href="../h_src/57948988.htm" class="localvar">L</a>, <a href="../h_src/57948716.htm" class="localvar">g</a>);
  1653 :    <a href="../h_src/57943684.htm" class="function">singlestep</a>(<a href="../h_src/57943140.htm" class="localvar">L</a>);
  1733 :    <a href="../h_src/57948580.htm" class="function">fullgen</a>(<a href="../h_src/57941100.htm" class="localvar">L</a>, <a href="../h_src/57940828.htm" class="localvar">g</a>);
</pre>
<pre>
</pre>
<h5>Missing/Mismatched Function Declarator</h5>
<pre>
   547 :    (<a href="../h_src/57547624.htm" class="macro">cast_void</a>(<a href="../h_src/57974556.htm" class="localvar">weakkey</a> = <a href="../h_aa/57565916.htm" class="libfunc">strchr</a>(<a href="../h_src/57522532.htm" class="macro">svalue</a>(<a href="../h_src/57974284.htm" class="localvar">mode</a>), 'k')),
   548 :    <a href="../h_src/57547624.htm" class="macro">cast_void</a>(<a href="../h_src/57974420.htm" class="localvar">weakvalue</a> = <a href="../h_aa/57565916.htm" class="libfunc">strchr</a>(<a href="../h_src/57522532.htm" class="macro">svalue</a>(<a href="../h_src/57974284.htm" class="localvar">mode</a>), 'v')),
   925 :    if (<a href="../h_src/57551568.htm" class="macro">l_unlikely</a>(<a href="../h_src/57961364.htm" class="localvar">status</a> != <a href="../h_src/57445204.htm" class="macro">LUA_OK</a>)) {  <a  class="comments">/* error while running __gc? */</a>
</pre>
<pre>

</pre>
</body>
</html>

