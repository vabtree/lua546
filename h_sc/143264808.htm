<html>
<head>
<!-- This html document was created by Imagix 4D -->
<link href="../htm/symbol.css" rel="stylesheet" type="text/css">
<link href="../htm/symcolors.css" rel="stylesheet" type="text/css">
<link href="../htm/notebook.css" rel="stylesheet" type="text/css">
<base target="symbol">
</head>
<body>

<h2>liolib.c</h2>

<div class="notebook">
<ul>
<li><a href="../h_aa/143264808.htm" class="file" target="_self">Info</a></li>
<li><a href="../h_im/143264808.htm" class="file" target="_self">Global Interface</a></li>
<li><a href="../h_rx/143264808.htm" class="file" target="_self">File Inclusion</a></li>
<li><a href="../h_nm/143264808.htm" class="file" target="_self">Internals</a></li>
<li><a href="../h_uf/143264808.htm" class="file" target="_self">Use of Elements</a></li>
<li><a href="../h_df/143264808.htm" class="file" target="_self">Dependencies</a></li>
<li id="current"><a href="../h_src/143264808.htm" class="file" target="_self">Source Code</a></li>
</ul>
</div>
<div class="notebook">
<ul>
<li><a href="../h_src/143264808.htm" class="file" target="_self">Source Code</a></li>
<li id="current"><a href="../h_sc/143264808.htm" class="file" target="_self">Source Checks</a></li>
</ul>
</div>
<div class="nb_clear">
</div>
<h4>Source Checks  <a class="legend">(see key)</a></h4>
<table cellpadding=0 cellspacing=0 border=0>
<tr><td>total instances:</td><td class=mtrc>120</td></tr>
<tr><td>total checks involved:</td><td class=mtrc>7</td></tr>
<tr><td>total lines  involved:</td><td class=mtrc>130</td></tr>
<tr><th></th></tr>
</table>
<pre>
</pre>
<h5>Number of Built-In Operators</h5>
<pre>
    41 :    return (*<a href="../h_src/143263924.htm" class="localvar">mode</a> != '\0' &amp;&amp; <a href="../h_aa/57565916.htm" class="libfunc">strchr</a>(&quot;rwa&quot;, *(<a href="../h_src/143263924.htm" class="localvar">mode</a>++)) != NULL &amp;&amp;
    42 :    (*<a href="../h_src/143263924.htm" class="localvar">mode</a> != '+' || ((void)(++<a href="../h_src/143263924.htm" class="localvar">mode</a>), 1)) &amp;&amp;  <a  class="comments">/* skip if char is '+' */</a>
    43 :    (<a href="../h_aa/57906692.htm" class="libfunc">strspn</a>(<a href="../h_src/143263924.htm" class="localvar">mode</a>, <a href="../h_src/143264196.htm" class="macro">L_MODEEXT</a>) == <a href="../h_aa/57568976.htm" class="libfunc">strlen</a>(<a href="../h_src/143263924.htm" class="localvar">mode</a>)));  <a  class="comments">/* check extensions */</a>
   294 :    <a href="../h_src/57417256.htm" class="macro">luaL_argcheck</a>(<a href="../h_src/143254676.htm" class="localvar">L</a>, <a href="../h_src/143263244.htm" class="macro">l_checkmodep</a>(<a href="../h_src/143254404.htm" class="localvar">mode</a>), 2, &quot;invalid mode&quot;);
</pre>
<pre>
</pre>
<h5>Conversion Issue</h5>
<pre>
   255 :    <a href="../h_src/143256920.htm" class="localvar">p</a>-&gt;f = NULL;
   263 :    <a href="../h_src/143256240.htm" class="localvar">p</a>-&gt;f = <a href="../h_aa/58324460.htm" class="libfunc">fopen</a>(<a href="../h_src/143256512.htm" class="localvar">fname</a>, <a href="../h_src/143256376.htm" class="localvar">mode</a>);
   275 :    <a href="../h_src/143255560.htm" class="localvar">p</a>-&gt;f = <a href="../h_aa/58324460.htm" class="libfunc">fopen</a>(<a href="../h_src/143255832.htm" class="localvar">filename</a>, <a href="../h_src/143255696.htm" class="localvar">mode</a>);
   285 :    errno = 0;
   295 :    <a href="../h_src/143254268.htm" class="localvar">p</a>-&gt;f = <a href="../h_src/143263652.htm" class="macro">l_popen</a>(L, <a href="../h_src/143254540.htm" class="localvar">filename</a>, <a href="../h_src/143254404.htm" class="localvar">mode</a>);
   303 :    <a href="../h_src/143253792.htm" class="localvar">p</a>-&gt;f = <a href="../h_aa/143253656.htm" class="libfunc">tmpfile</a>();
   444 :    <a href="../h_src/143249508.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143249916.htm" class="variable">buff</a>[<a href="../h_src/143249508.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143249984.htm" class="variable">n</a>++] = <a href="../h_src/143249508.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143250052.htm" class="variable">c</a>;  <a  class="comments">/* save current char */</a>
   572 :    <a href="../h_src/143247740.htm" class="variable">n</a> = first + 1;  <a  class="comments">/* to return 1 result */</a>
   691 :    FILE *f = <a href="../h_src/143259980.htm" class="function">tofile</a>(<a href="../h_src/143245632.htm" class="localvar">L</a>);
   691 :    FILE *f = <a href="../h_src/143259980.htm" class="function">tofile</a>(<a href="../h_src/143245632.htm" class="localvar">L</a>);
   700 :    FILE *f = <a href="../h_src/143259980.htm" class="function">tofile</a>(<a href="../h_src/143245360.htm" class="localvar">L</a>);
   700 :    FILE *f = <a href="../h_src/143259980.htm" class="function">tofile</a>(<a href="../h_src/143245360.htm" class="localvar">L</a>);
   704 :    <a href="../h_src/57417256.htm" class="macro">luaL_argcheck</a>(<a href="../h_src/143245360.htm" class="localvar">L</a>, (<a href="../h_src/57442076.htm" class="type">lua_Integer</a>)<a href="../h_src/143244680.htm" class="localvar">offset</a> == <a href="../h_src/143244816.htm" class="localvar">p3</a>, 3,
   719 :    FILE *f = <a href="../h_src/143259980.htm" class="function">tofile</a>(<a href="../h_src/143244272.htm" class="localvar">L</a>);
   719 :    FILE *f = <a href="../h_src/143259980.htm" class="function">tofile</a>(<a href="../h_src/143244272.htm" class="localvar">L</a>);
   722 :    int <a href="../h_src/143243524.htm" class="localvar">res</a> = <a href="../h_aa/143243592.htm" class="libfunc">setvbuf</a>(f, NULL, <a href="../h_src/143244136.htm" class="localvar">mode</a>[<a href="../h_src/143243864.htm" class="localvar">op</a>], (<a href="../h_aa/57441192.htm" class="type">size_t</a>)<a href="../h_src/143243728.htm" class="localvar">sz</a>);
   741 :    static const <a href="../h_src/57420996.htm" class="type">luaL_Reg</a> <a href="../h_src/143242844.htm" class="variable">iolib</a>[] = {
   742 :    {&quot;close&quot;, <a href="../h_src/143258416.htm" class="function">io_close</a>},
   743 :    {&quot;flush&quot;, <a href="../h_src/143243388.htm" class="function">io_flush</a>},
   744 :    {&quot;input&quot;, <a href="../h_src/143252432.htm" class="function">io_input</a>},
   745 :    {&quot;lines&quot;, <a href="../h_src/143250800.htm" class="function">io_lines</a>},
   746 :    {&quot;open&quot;, <a href="../h_src/143256104.htm" class="function">io_open</a>},
   747 :    {&quot;output&quot;, <a href="../h_src/143252160.htm" class="function">io_output</a>},
   748 :    {&quot;popen&quot;, <a href="../h_src/143254812.htm" class="function">io_popen</a>},
   749 :    {&quot;read&quot;, <a href="../h_src/143247400.htm" class="function">io_read</a>},
   750 :    {&quot;tmpfile&quot;, <a href="../h_src/143254064.htm" class="function">io_tmpfile</a>},
   751 :    {&quot;type&quot;, <a href="../h_src/143260864.htm" class="function">io_type</a>},
   752 :    {&quot;write&quot;, <a href="../h_src/143246108.htm" class="function">io_write</a>},
   760 :    static const <a href="../h_src/57420996.htm" class="type">luaL_Reg</a> <a href="../h_src/143242776.htm" class="variable">meth</a>[] = {
   761 :    {&quot;read&quot;, <a href="../h_src/143247060.htm" class="function">f_read</a>},
   762 :    {&quot;write&quot;, <a href="../h_src/143245768.htm" class="function">f_write</a>},
   763 :    {&quot;lines&quot;, <a href="../h_src/143251072.htm" class="function">f_lines</a>},
   764 :    {&quot;flush&quot;, <a href="../h_src/143243116.htm" class="function">f_flush</a>},
   765 :    {&quot;seek&quot;, <a href="../h_src/143245496.htm" class="function">f_seek</a>},
   766 :    {&quot;close&quot;, <a href="../h_src/143258688.htm" class="function">f_close</a>},
   767 :    {&quot;setvbuf&quot;, <a href="../h_src/143244408.htm" class="function">f_setvbuf</a>},
   775 :    static const <a href="../h_src/57420996.htm" class="type">luaL_Reg</a> <a href="../h_src/143242708.htm" class="variable">metameth</a>[] = {
   776 :    {&quot;__index&quot;, NULL},  <a  class="comments">/* place holder */</a>
   777 :    {&quot;__gc&quot;, <a href="../h_src/143258144.htm" class="function">f_gc</a>},
   778 :    {&quot;__close&quot;, <a href="../h_src/143258144.htm" class="function">f_gc</a>},
   779 :    {&quot;__tostring&quot;, <a href="../h_src/143260388.htm" class="function">f_tostring</a>},
</pre>
<pre>
</pre>
<h5>Needs Compound Statement</h5>
<pre>
   167 :    if (<a href="../h_src/143260524.htm" class="localvar">p</a> == NULL)
   168 :    <a href="../h_src/57415760.htm" class="macro">luaL_pushfail</a>(<a href="../h_src/143260728.htm" class="localvar">L</a>);  <a  class="comments">/* not a file */</a>
   169 :    else if (<a href="../h_src/143261000.htm" class="macro">isclosed</a>(<a href="../h_src/143260524.htm" class="localvar">p</a>))
   170 :    <a href="../h_src/57427660.htm" class="macro">lua_pushliteral</a>(<a href="../h_src/143260728.htm" class="localvar">L</a>, &quot;closed file&quot;);
   171 :    else
   172 :    <a href="../h_src/57427660.htm" class="macro">lua_pushliteral</a>(<a href="../h_src/143260728.htm" class="localvar">L</a>, &quot;file&quot;);
   179 :    if (<a href="../h_src/143261000.htm" class="macro">isclosed</a>(<a href="../h_src/143260116.htm" class="localvar">p</a>))
   180 :    <a href="../h_src/57427660.htm" class="macro">lua_pushliteral</a>(<a href="../h_src/143260252.htm" class="localvar">L</a>, &quot;file (closed)&quot;);
   181 :    else
   182 :    <a href="../h_src/57434732.htm" class="function">lua_pushfstring</a>(<a href="../h_src/143260252.htm" class="localvar">L</a>, &quot;file (%p)&quot;, <a href="../h_src/143260116.htm" class="localvar">p</a>-&gt;f);
   189 :    if (<a href="../h_src/57551568.htm" class="macro">l_unlikely</a>(<a href="../h_src/143261000.htm" class="macro">isclosed</a>(<a href="../h_src/143259776.htm" class="localvar">p</a>)))
   190 :    <a href="../h_src/57419296.htm" class="function">luaL_error</a>(<a href="../h_src/143259912.htm" class="localvar">L</a>, &quot;attempt to use a closed file&quot;);
   229 :    if (<a href="../h_src/57427932.htm" class="macro">lua_isnone</a>(<a href="../h_src/143258280.htm" class="localvar">L</a>, 1))  <a  class="comments">/* no argument? */</a>
   230 :    <a href="../h_src/57434256.htm" class="function">lua_getfield</a>(<a href="../h_src/143258280.htm" class="localvar">L</a>, <a href="../h_src/57445476.htm" class="macro">LUA_REGISTRYINDEX</a>, <a href="../h_src/143261340.htm" class="macro">IO_OUTPUT</a>);  <a  class="comments">/* use default output */</a>
   237 :    if (!<a href="../h_src/143261000.htm" class="macro">isclosed</a>(<a href="../h_src/143257872.htm" class="localvar">p</a>) &amp;&amp; <a href="../h_src/143257872.htm" class="localvar">p</a>-&gt;f != NULL)
   238 :    <a href="../h_src/143259232.htm" class="function">aux_close</a>(<a href="../h_src/143258008.htm" class="localvar">L</a>);  <a  class="comments">/* ignore closed and incompletely open files */</a>
   264 :    if (<a href="../h_src/57551568.htm" class="macro">l_unlikely</a>(<a href="../h_src/143256240.htm" class="localvar">p</a>-&gt;f == NULL))
   265 :    <a href="../h_src/57419296.htm" class="function">luaL_error</a>(<a href="../h_src/143256648.htm" class="localvar">L</a>, &quot;cannot open file '%s' (%s)&quot;, <a href="../h_src/143256512.htm" class="localvar">fname</a>, <a href="../h_aa/58343432.htm" class="libfunc">strerror</a>(errno));
   312 :    if (<a href="../h_src/57551568.htm" class="macro">l_unlikely</a>(<a href="../h_src/143261000.htm" class="macro">isclosed</a>(<a href="../h_src/143253248.htm" class="localvar">p</a>)))
   313 :    <a href="../h_src/57419296.htm" class="function">luaL_error</a>(<a href="../h_src/143253520.htm" class="localvar">L</a>, &quot;default %s file is closed&quot;, <a href="../h_src/143253384.htm" class="localvar">findex</a> + <a href="../h_src/143261612.htm" class="macro">IOPREF_LEN</a>);
   321 :    if (<a href="../h_src/143252568.htm" class="localvar">filename</a>)
   322 :    <a href="../h_src/143256784.htm" class="function">opencheck</a>(<a href="../h_src/143252976.htm" class="localvar">L</a>, <a href="../h_src/143252568.htm" class="localvar">filename</a>, <a href="../h_src/143252704.htm" class="localvar">mode</a>);
   388 :    if (<a href="../h_src/57427932.htm" class="macro">lua_isnone</a>(<a href="../h_src/143250664.htm" class="localvar">L</a>, 1)) <a href="../h_src/57435276.htm" class="function">lua_pushnil</a>(<a href="../h_src/143250664.htm" class="localvar">L</a>);  <a  class="comments">/* at least one argument */</a>
   408 :    else
   409 :    return 1;
   455 :    if (<a href="../h_src/143249236.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143250052.htm" class="variable">c</a> == <a href="../h_src/143249100.htm" class="localvar">set</a>[0] || <a href="../h_src/143249236.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143250052.htm" class="variable">c</a> == <a href="../h_src/143249100.htm" class="localvar">set</a>[1])
   456 :    return <a href="../h_src/143249712.htm" class="function">nextc</a>(<a href="../h_src/143249236.htm" class="localvar">rn</a>);
   457 :    else return 0;
   466 :    while ((<a href="../h_src/143248692.htm" class="localvar">hex</a> ? <a href="../h_aa/143248420.htm" class="libfunc">isxdigit</a>(<a href="../h_src/143248828.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143250052.htm" class="variable">c</a>) : <a href="../h_aa/58309772.htm" class="libfunc">isdigit</a>(<a href="../h_src/143248828.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143250052.htm" class="variable">c</a>)) &amp;&amp; <a href="../h_src/143249712.htm" class="function">nextc</a>(<a href="../h_src/143248828.htm" class="localvar">rn</a>))
   467 :    <a href="../h_src/143248556.htm" class="localvar">count</a>++;
   633 :    if (<a href="../h_src/143261000.htm" class="macro">isclosed</a>(<a href="../h_src/143246652.htm" class="localvar">p</a>))  <a  class="comments">/* file is already closed? */</a>
   634 :    return <a href="../h_src/57419296.htm" class="function">luaL_error</a>(<a href="../h_src/143246788.htm" class="localvar">L</a>, &quot;file is already closed&quot;);
   637 :    for (<a href="../h_src/143246516.htm" class="localvar">i</a> = 1; <a href="../h_src/143246516.htm" class="localvar">i</a> &lt;= <a href="../h_src/143246380.htm" class="localvar">n</a>; <a href="../h_src/143246516.htm" class="localvar">i</a>++)  <a  class="comments">/* push arguments to 'g_read' */</a>
   638 :    <a href="../h_src/57439220.htm" class="function">lua_pushvalue</a>(<a href="../h_src/143246788.htm" class="localvar">L</a>, <a href="../h_src/57445340.htm" class="macro">lua_upvalueindex</a>(3 + <a href="../h_src/143246516.htm" class="localvar">i</a>));
   641 :    if (<a href="../h_src/57438268.htm" class="function">lua_toboolean</a>(<a href="../h_src/143246788.htm" class="localvar">L</a>, -<a href="../h_src/143246380.htm" class="localvar">n</a>))  <a  class="comments">/* read at least one value? */</a>
   642 :    return <a href="../h_src/143246380.htm" class="localvar">n</a>;  <a  class="comments">/* return them */</a>
   707 :    if (<a href="../h_src/57551568.htm" class="macro">l_unlikely</a>(<a href="../h_src/143244952.htm" class="localvar">op</a>))
   708 :    return <a href="../h_src/57419092.htm" class="function">luaL_fileresult</a>(<a href="../h_src/143245360.htm" class="localvar">L</a>, 0, NULL);  <a  class="comments">/* error */</a>
</pre>
<pre>
</pre>
<h5>Return Ignored</h5>
<pre>
   170 :    <a href="../h_src/57427660.htm" class="macro">lua_pushliteral</a>(<a href="../h_src/143260728.htm" class="localvar">L</a>, &quot;closed file&quot;);
   172 :    <a href="../h_src/57427660.htm" class="macro">lua_pushliteral</a>(<a href="../h_src/143260728.htm" class="localvar">L</a>, &quot;file&quot;);
   180 :    <a href="../h_src/57427660.htm" class="macro">lua_pushliteral</a>(<a href="../h_src/143260252.htm" class="localvar">L</a>, &quot;file (closed)&quot;);
   182 :    <a href="../h_src/57434732.htm" class="function">lua_pushfstring</a>(<a href="../h_src/143260252.htm" class="localvar">L</a>, &quot;file (%p)&quot;, <a href="../h_src/143260116.htm" class="localvar">p</a>-&gt;f);
   190 :    <a href="../h_src/57419296.htm" class="function">luaL_error</a>(<a href="../h_src/143259912.htm" class="localvar">L</a>, &quot;attempt to use a closed file&quot;);
   223 :    <a href="../h_src/143259980.htm" class="function">tofile</a>(<a href="../h_src/143258552.htm" class="localvar">L</a>);  <a  class="comments">/* make sure argument is an open stream */</a>
   230 :    <a href="../h_src/57434256.htm" class="function">lua_getfield</a>(<a href="../h_src/143258280.htm" class="localvar">L</a>, <a href="../h_src/57445476.htm" class="macro">LUA_REGISTRYINDEX</a>, <a href="../h_src/143261340.htm" class="macro">IO_OUTPUT</a>);  <a  class="comments">/* use default output */</a>
   238 :    <a href="../h_src/143259232.htm" class="function">aux_close</a>(<a href="../h_src/143258008.htm" class="localvar">L</a>);  <a  class="comments">/* ignore closed and incompletely open files */</a>
   265 :    <a href="../h_src/57419296.htm" class="function">luaL_error</a>(<a href="../h_src/143256648.htm" class="localvar">L</a>, &quot;cannot open file '%s' (%s)&quot;, <a href="../h_src/143256512.htm" class="localvar">fname</a>, <a href="../h_aa/58343432.htm" class="libfunc">strerror</a>(errno));
   310 :    <a href="../h_src/57434256.htm" class="function">lua_getfield</a>(<a href="../h_src/143253520.htm" class="localvar">L</a>, <a href="../h_src/57445476.htm" class="macro">LUA_REGISTRYINDEX</a>, <a href="../h_src/143253384.htm" class="localvar">findex</a>);
   313 :    <a href="../h_src/57419296.htm" class="function">luaL_error</a>(<a href="../h_src/143253520.htm" class="localvar">L</a>, &quot;default %s file is closed&quot;, <a href="../h_src/143253384.htm" class="localvar">findex</a> + <a href="../h_src/143261612.htm" class="macro">IOPREF_LEN</a>);
   324 :    <a href="../h_src/143259980.htm" class="function">tofile</a>(<a href="../h_src/143252976.htm" class="localvar">L</a>);  <a  class="comments">/* check that it's a valid file handle */</a>
   330 :    <a href="../h_src/57434256.htm" class="function">lua_getfield</a>(<a href="../h_src/143252976.htm" class="localvar">L</a>, <a href="../h_src/57445476.htm" class="macro">LUA_REGISTRYINDEX</a>, <a href="../h_src/143252840.htm" class="localvar">f</a>);
   375 :    <a href="../h_src/143259980.htm" class="function">tofile</a>(<a href="../h_src/143250936.htm" class="localvar">L</a>);  <a  class="comments">/* check that it's a valid file handle */</a>
   390 :    <a href="../h_src/57434256.htm" class="function">lua_getfield</a>(<a href="../h_src/143250664.htm" class="localvar">L</a>, <a href="../h_src/57445476.htm" class="macro">LUA_REGISTRYINDEX</a>, <a href="../h_src/143261476.htm" class="macro">IO_INPUT</a>);  <a  class="comments">/* get default input */</a>
   392 :    <a href="../h_src/143259980.htm" class="function">tofile</a>(<a href="../h_src/143250664.htm" class="localvar">L</a>);  <a  class="comments">/* check that it's a valid file handle */</a>
   651 :    <a href="../h_src/143259232.htm" class="function">aux_close</a>(<a href="../h_src/143246788.htm" class="localvar">L</a>);  <a  class="comments">/* close it */</a>
   785 :    <a href="../h_src/57419636.htm" class="function">luaL_newmetatable</a>(<a href="../h_src/143242504.htm" class="localvar">L</a>, <a href="../h_src/57412972.htm" class="macro">LUA_FILEHANDLE</a>);  <a  class="comments">/* metatable for file handles */</a>
   800 :    <a href="../h_src/57415760.htm" class="macro">luaL_pushfail</a>(<a href="../h_src/143242232.htm" class="localvar">L</a>);
   801 :    <a href="../h_src/57427660.htm" class="macro">lua_pushliteral</a>(<a href="../h_src/143242232.htm" class="localvar">L</a>, &quot;cannot close standard file&quot;);
</pre>
<pre>
</pre>
<h5>Missing/Mismatched Function Declarator</h5>
<pre>
    41 :    return (*<a href="../h_src/143263924.htm" class="localvar">mode</a> != '\0' &amp;&amp; <a href="../h_aa/57565916.htm" class="libfunc">strchr</a>(&quot;rwa&quot;, *(<a href="../h_src/143263924.htm" class="localvar">mode</a>++)) != NULL &amp;&amp;
    43 :    (<a href="../h_aa/57906692.htm" class="libfunc">strspn</a>(<a href="../h_src/143263924.htm" class="localvar">mode</a>, <a href="../h_src/143264196.htm" class="macro">L_MODEEXT</a>) == <a href="../h_aa/57568976.htm" class="libfunc">strlen</a>(<a href="../h_src/143263924.htm" class="localvar">mode</a>)));  <a  class="comments">/* check extensions */</a>
    43 :    (<a href="../h_aa/57906692.htm" class="libfunc">strspn</a>(<a href="../h_src/143263924.htm" class="localvar">mode</a>, <a href="../h_src/143264196.htm" class="macro">L_MODEEXT</a>) == <a href="../h_aa/57568976.htm" class="libfunc">strlen</a>(<a href="../h_src/143263924.htm" class="localvar">mode</a>)));  <a  class="comments">/* check extensions */</a>
   189 :    if (<a href="../h_src/57551568.htm" class="macro">l_unlikely</a>(<a href="../h_src/143261000.htm" class="macro">isclosed</a>(<a href="../h_src/143259776.htm" class="localvar">p</a>)))
   218 :    return (*<a href="../h_src/143258824.htm" class="localvar">cf</a>)(<a href="../h_src/143259096.htm" class="localvar">L</a>);  <a  class="comments">/* close it */</a>
   248 :    int <a href="../h_src/143257328.htm" class="localvar">res</a> = <a href="../h_aa/58324188.htm" class="libfunc">fclose</a>(<a href="../h_src/143257464.htm" class="localvar">p</a>-&gt;f);
   263 :    <a href="../h_src/143256240.htm" class="localvar">p</a>-&gt;f = <a href="../h_aa/58324460.htm" class="libfunc">fopen</a>(<a href="../h_src/143256512.htm" class="localvar">fname</a>, <a href="../h_src/143256376.htm" class="localvar">mode</a>);
   264 :    if (<a href="../h_src/57551568.htm" class="macro">l_unlikely</a>(<a href="../h_src/143256240.htm" class="localvar">p</a>-&gt;f == NULL))
   265 :    <a href="../h_src/57419296.htm" class="function">luaL_error</a>(<a href="../h_src/143256648.htm" class="localvar">L</a>, &quot;cannot open file '%s' (%s)&quot;, <a href="../h_src/143256512.htm" class="localvar">fname</a>, <a href="../h_aa/58343432.htm" class="libfunc">strerror</a>(errno));
   274 :    <a href="../h_src/57417256.htm" class="macro">luaL_argcheck</a>(<a href="../h_src/143255968.htm" class="localvar">L</a>, <a href="../h_src/143264060.htm" class="function">l_checkmode</a>(<a href="../h_src/143255424.htm" class="localvar">md</a>), 2, &quot;invalid mode&quot;);
   275 :    <a href="../h_src/143255560.htm" class="localvar">p</a>-&gt;f = <a href="../h_aa/58324460.htm" class="libfunc">fopen</a>(<a href="../h_src/143255832.htm" class="localvar">filename</a>, <a href="../h_src/143255696.htm" class="localvar">mode</a>);
   286 :    return <a href="../h_src/57419024.htm" class="function">luaL_execresult</a>(<a href="../h_src/143255152.htm" class="localvar">L</a>, <a href="../h_src/143263516.htm" class="macro">l_pclose</a>(L, <a href="../h_src/143255016.htm" class="localvar">p</a>-&gt;f));
   294 :    <a href="../h_src/57417256.htm" class="macro">luaL_argcheck</a>(<a href="../h_src/143254676.htm" class="localvar">L</a>, <a href="../h_src/143263244.htm" class="macro">l_checkmodep</a>(<a href="../h_src/143254404.htm" class="localvar">mode</a>), 2, &quot;invalid mode&quot;);
   295 :    <a href="../h_src/143254268.htm" class="localvar">p</a>-&gt;f = <a href="../h_src/143263652.htm" class="macro">l_popen</a>(L, <a href="../h_src/143254540.htm" class="localvar">filename</a>, <a href="../h_src/143254404.htm" class="localvar">mode</a>);
   303 :    <a href="../h_src/143253792.htm" class="localvar">p</a>-&gt;f = <a href="../h_aa/143253656.htm" class="libfunc">tmpfile</a>();
   312 :    if (<a href="../h_src/57551568.htm" class="macro">l_unlikely</a>(<a href="../h_src/143261000.htm" class="macro">isclosed</a>(<a href="../h_src/143253248.htm" class="localvar">p</a>)))
   365 :    <a href="../h_src/57417256.htm" class="macro">luaL_argcheck</a>(<a href="../h_src/143251480.htm" class="localvar">L</a>, <a href="../h_src/143251208.htm" class="localvar">n</a> &lt;= <a href="../h_src/143251752.htm" class="macro">MAXARGLINE</a>, <a href="../h_src/143251752.htm" class="macro">MAXARGLINE</a> + 2, &quot;too many arguments&quot;);
   439 :    if (<a href="../h_src/57551568.htm" class="macro">l_unlikely</a>(<a href="../h_src/143249508.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143249984.htm" class="variable">n</a> &gt;= <a href="../h_src/143250256.htm" class="macro">L_MAXLENNUM</a>)) {  <a  class="comments">/* buffer overflow? */</a>
   445 :    <a href="../h_src/143249508.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143250052.htm" class="variable">c</a> = <a href="../h_src/143262972.htm" class="macro">l_getc</a>(<a href="../h_src/143249508.htm" class="localvar">rn</a>-&gt;f);  <a  class="comments">/* read next one */</a>
   466 :    while ((<a href="../h_src/143248692.htm" class="localvar">hex</a> ? <a href="../h_aa/143248420.htm" class="libfunc">isxdigit</a>(<a href="../h_src/143248828.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143250052.htm" class="variable">c</a>) : <a href="../h_aa/58309772.htm" class="libfunc">isdigit</a>(<a href="../h_src/143248828.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143250052.htm" class="variable">c</a>)) &amp;&amp; <a href="../h_src/143249712.htm" class="function">nextc</a>(<a href="../h_src/143248828.htm" class="localvar">rn</a>))
   466 :    while ((<a href="../h_src/143248692.htm" class="localvar">hex</a> ? <a href="../h_aa/143248420.htm" class="libfunc">isxdigit</a>(<a href="../h_src/143248828.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143250052.htm" class="variable">c</a>) : <a href="../h_aa/58309772.htm" class="libfunc">isdigit</a>(<a href="../h_src/143248828.htm" class="localvar">rn</a>-&gt;<a href="../h_src/143250052.htm" class="variable">c</a>)) &amp;&amp; <a href="../h_src/143249712.htm" class="function">nextc</a>(<a href="../h_src/143248828.htm" class="localvar">rn</a>))
   483 :    <a href="../h_src/143248216.htm" class="variable">decp</a>[0] = <a href="../h_src/57448468.htm" class="macro">lua_getlocaledecpoint</a>();  <a  class="comments">/* get decimal point from locale */</a>
   546 :    <a href="../h_src/143247876.htm" class="variable">nr</a> = <a href="../h_aa/58326568.htm" class="libfunc">fread</a>(p, sizeof(char), <a href="../h_src/57447244.htm" class="macro">LUAL_BUFFERSIZE</a>, f);
   559 :    <a href="../h_src/143247876.htm" class="variable">nr</a> = <a href="../h_aa/58326568.htm" class="libfunc">fread</a>(p, sizeof(char), <a href="../h_src/143247740.htm" class="variable">n</a>, f);  <a  class="comments">/* try to read 'n' chars */</a>
   581 :    <a href="../h_src/143247672.htm" class="variable">success</a> = (l == 0) ? <a href="../h_aa/143247536.htm" class="libfunc">test_eof</a>(L, f) : <a href="../h_aa/143247468.htm" class="libfunc">read_chars</a>(L, f, l);
   581 :    <a href="../h_src/143247672.htm" class="variable">success</a> = (l == 0) ? <a href="../h_aa/143247536.htm" class="libfunc">test_eof</a>(L, f) : <a href="../h_aa/143247468.htm" class="libfunc">read_chars</a>(L, f, l);
   617 :    return <a href="../h_aa/143247128.htm" class="libfunc">g_read</a>(<a href="../h_src/143247264.htm" class="localvar">L</a>, <a href="../h_src/143253588.htm" class="function">getiofile</a>(<a href="../h_src/143247264.htm" class="localvar">L</a>, <a href="../h_src/143261476.htm" class="macro">IO_INPUT</a>), 1);
   622 :    return <a href="../h_aa/143247128.htm" class="libfunc">g_read</a>(<a href="../h_src/143246924.htm" class="localvar">L</a>, <a href="../h_src/143259980.htm" class="function">tofile</a>(<a href="../h_src/143246924.htm" class="localvar">L</a>), 2);
   639 :    <a href="../h_src/143246380.htm" class="localvar">n</a> = <a href="../h_aa/143247128.htm" class="libfunc">g_read</a>(<a href="../h_src/143246788.htm" class="localvar">L</a>, <a href="../h_src/143246652.htm" class="localvar">p</a>-&gt;f, 2);  <a  class="comments">/* 'n' is number of results */</a>
   676 :    <a href="../h_src/143246244.htm" class="variable">status</a> = status &amp;&amp; (<a href="../h_aa/57568908.htm" class="libfunc">fwrite</a>(s, sizeof(char), l, f) == l);
   686 :    return <a href="../h_aa/143245836.htm" class="libfunc">g_write</a>(<a href="../h_src/143245972.htm" class="localvar">L</a>, <a href="../h_src/143253588.htm" class="function">getiofile</a>(<a href="../h_src/143245972.htm" class="localvar">L</a>, <a href="../h_src/143261340.htm" class="macro">IO_OUTPUT</a>), 1);
   693 :    return <a href="../h_aa/143245836.htm" class="libfunc">g_write</a>(<a href="../h_src/143245632.htm" class="localvar">L</a>, f, 2);
   704 :    <a href="../h_src/57417256.htm" class="macro">luaL_argcheck</a>(<a href="../h_src/143245360.htm" class="localvar">L</a>, (<a href="../h_src/57442076.htm" class="type">lua_Integer</a>)<a href="../h_src/143244680.htm" class="localvar">offset</a> == <a href="../h_src/143244816.htm" class="localvar">p3</a>, 3,
   706 :    <a href="../h_src/143244952.htm" class="localvar">op</a> = <a href="../h_src/143262156.htm" class="macro">l_fseek</a>(f, <a href="../h_src/143244680.htm" class="localvar">offset</a>, <a href="../h_src/143245224.htm" class="localvar">mode</a>[<a href="../h_src/143244952.htm" class="localvar">op</a>]);
   707 :    if (<a href="../h_src/57551568.htm" class="macro">l_unlikely</a>(<a href="../h_src/143244952.htm" class="localvar">op</a>))
   710 :    <a href="../h_src/57435140.htm" class="function">lua_pushinteger</a>(<a href="../h_src/143245360.htm" class="localvar">L</a>, (<a href="../h_src/57442076.htm" class="type">lua_Integer</a>)<a href="../h_src/143262020.htm" class="macro">l_ftell</a>(f));
   722 :    int <a href="../h_src/143243524.htm" class="localvar">res</a> = <a href="../h_aa/143243592.htm" class="libfunc">setvbuf</a>(f, NULL, <a href="../h_src/143244136.htm" class="localvar">mode</a>[<a href="../h_src/143243864.htm" class="localvar">op</a>], (<a href="../h_aa/57441192.htm" class="type">size_t</a>)<a href="../h_src/143243728.htm" class="localvar">sz</a>);
   729 :    return <a href="../h_src/57419092.htm" class="function">luaL_fileresult</a>(<a href="../h_src/143243252.htm" class="localvar">L</a>, <a href="../h_aa/57571356.htm" class="libfunc">fflush</a>(<a href="../h_src/143253588.htm" class="function">getiofile</a>(<a href="../h_src/143243252.htm" class="localvar">L</a>, <a href="../h_src/143261340.htm" class="macro">IO_OUTPUT</a>)) == 0, NULL);
   734 :    return <a href="../h_src/57419092.htm" class="function">luaL_fileresult</a>(<a href="../h_src/143242980.htm" class="localvar">L</a>, <a href="../h_aa/57571356.htm" class="libfunc">fflush</a>(<a href="../h_src/143259980.htm" class="function">tofile</a>(<a href="../h_src/143242980.htm" class="localvar">L</a>)) == 0, NULL);
   823 :    <a href="../h_aa/143241824.htm" class="libfunc">createstdfile</a>(<a href="../h_src/143241960.htm" class="localvar">L</a>, stdin, <a href="../h_src/143261476.htm" class="macro">IO_INPUT</a>, &quot;stdin&quot;);
   824 :    <a href="../h_aa/143241824.htm" class="libfunc">createstdfile</a>(<a href="../h_src/143241960.htm" class="localvar">L</a>, stdout, <a href="../h_src/143261340.htm" class="macro">IO_OUTPUT</a>, &quot;stdout&quot;);
   825 :    <a href="../h_aa/143241824.htm" class="libfunc">createstdfile</a>(<a href="../h_src/143241960.htm" class="localvar">L</a>, stderr, NULL, &quot;stderr&quot;);
</pre>
<pre>
</pre>
<h5>Missing Return Type</h5>
<pre>
   187 :    static FILE *<a href="../h_src/143259980.htm" class="function">tofile</a> (<a href="../h_src/57444252.htm" class="type">lua_State</a> *<a href="../h_src/143259912.htm" class="localvar">L</a>) {
   308 :    static FILE *<a href="../h_src/143253588.htm" class="function">getiofile</a> (<a href="../h_src/57444252.htm" class="type">lua_State</a> *<a href="../h_src/143253520.htm" class="localvar">L</a>, const char *<a href="../h_src/143253384.htm" class="localvar">findex</a>) {
   513 :    <a href="../h_aa/143248148.htm" class="libfunc">ungetc</a>(c, f);  <a  class="comments">/* no-op when c == EOF */</a>
   569 :    <a href="../h_aa/143247604.htm" class="libfunc">clearerr</a>(f);
   610 :    <a href="../h_src/57415760.htm" class="macro">luaL_pushfail</a>(L);  <a  class="comments">/* push nil instead */</a>
</pre>
<pre>
</pre>
<h5>Unused Local</h5>
<pre>
   481 :    char <a href="../h_src/143248216.htm" class="variable">decp</a>[2];
   483 :    <a href="../h_src/143248216.htm" class="variable">decp</a>[0] = <a href="../h_src/57448468.htm" class="macro">lua_getlocaledecpoint</a>();  <a  class="comments">/* get decimal point from locale */</a>
   484 :    <a href="../h_src/143248216.htm" class="variable">decp</a>[1] = '.';  <a  class="comments">/* always accept a dot */</a>
   521 :    int <a href="../h_src/143248080.htm" class="variable">c</a>;
   542 :    <a href="../h_src/57421744.htm" class="type">luaL_Buffer</a> <a href="../h_src/143247944.htm" class="variable">b</a>;
   556 :    <a href="../h_src/57421744.htm" class="type">luaL_Buffer</a> <a href="../h_src/143247944.htm" class="variable">b</a>;
   555 :    char *<a href="../h_src/143247808.htm" class="variable">p</a>;
   558 :    <a href="../h_src/143247808.htm" class="variable">p</a> = <a href="../h_src/57413584.htm" class="function">luaL_prepbuffsize</a>(&amp;b, n);  <a  class="comments">/* prepare buffer to read whole block */</a>
   568 :    int <a href="../h_src/143247740.htm" class="variable">n</a>, <a href="../h_src/143247672.htm" class="variable">success</a>;
   577 :    <a href="../h_src/143247672.htm" class="variable">success</a> = 1;
   581 :    <a href="../h_src/143247672.htm" class="variable">success</a> = (l == 0) ? <a href="../h_aa/143247536.htm" class="libfunc">test_eof</a>(L, f) : <a href="../h_aa/143247468.htm" class="libfunc">read_chars</a>(L, f, l);
   598 :    <a href="../h_src/143247672.htm" class="variable">success</a> = 1; <a  class="comments">/* always success */</a>
</pre>
<pre>

</pre>
</body>
</html>

